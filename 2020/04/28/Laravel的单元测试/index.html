<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2"/>





















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"/>

<link rel="stylesheet" href="/css/main.css?v=7.0.1"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="思考并回答以下问题：">
<meta name="keywords" content="Laravel">
<meta property="og:type" content="article">
<meta property="og:title" content="Laravel的单元测试">
<meta property="og:url" content="http://chebincarl.github.io/2020/04/28/Laravel的单元测试/index.html">
<meta property="og:site_name" content="车斌的博客">
<meta property="og:description" content="思考并回答以下问题：">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-04-28T12:17:33.656Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Laravel的单元测试">
<meta name="twitter:description" content="思考并回答以下问题：">






  <link rel="canonical" href="http://chebincarl.github.io/2020/04/28/Laravel的单元测试/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Laravel的单元测试 | 车斌的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">车斌的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">专注，重复10遍</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br/>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br/>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br/>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br/>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chebincarl.github.io/2020/04/28/Laravel的单元测试/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chebin"/>
      <meta itemprop="description" content="记录自己的学习过程"/>
      <meta itemprop="image" content="/images/avatar.jpg"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="车斌的博客"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Laravel的单元测试

              
            
          </h1>
        

        <div class="post-meta">

          

          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-04-28 10:07:21 / 修改时间：20:17:33" itemprop="dateCreated datePublished" datetime="2020-04-28T10:07:21+08:00">2020-04-28</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">18k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">16 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>思考并回答以下问题：</p>
<a id="more"></a>
<h1 id="PHPUnit"><a href="#PHPUnit" class="headerlink" title="PHPUnit"></a>PHPUnit</h1><h1 id="Laravel的单元测试"><a href="#Laravel的单元测试" class="headerlink" title="Laravel的单元测试"></a>Laravel的单元测试</h1><h2 id="创建一个新的测试"><a href="#创建一个新的测试" class="headerlink" title="创建一个新的测试"></a>创建一个新的测试</h2><p>使用 PHPUnit 的第一步是创建一个新的测试类。测试类的约定是它们存储在应用程序目录的 ./tests/ 下。在这个文件夹中，每个测试类都被命名为 <name>Test.php 。这种格式允许 PHPUnit 查找每个测试类—-它将忽略任何不以 Test.php 结尾的文件。</name></p>
<p>在新的 Laravel 应用程序中，你会注意到 ./tests/ 目录中有两个文件： ExampleTest.php 和 TestCase.php. TestCase.php 文件是一个引导文件用于在我们的测试中设置 Laravel 环境。这允许我们在测试中使用 Laravel Facades 并为测试助手提供框架，我们将在稍后介绍。 ExampleTest.php 是一个示例测试类，其中包含使用应用程序测试助手的基本测试用例-暂时忽略它。</p>
<p>要创建一个新的测试类，我们可以手动创建一个新文件，或者运行由 Laravel 提供的 Artisan 命令 make:test</p>
<p>为了创建一个名为 BasicTest 的测试类，我们只需要运行这个 artisan 命令：</p>
<p>php artisan make:test BasicTest</p>
<p>Laravel 将创建一个如下所示的基本测试类：</p>
<p>&lt;?php<br>class BasicTest extends TestCase<br>{<br>    /**</p>
<pre><code>* 一个基本的测试示例。
*
* @return void
*/
public function testExample()
{
    $this-&gt;assertTrue(true);
}
</code></pre><p>}</p>
<p>这里要注意的最重要的事情是 test 方法名称上的前缀，与 Test 类名后缀一样，这样 test 前缀告诉 PHPUnit 在测试时运行哪些方法。如果您忘记了 test 前缀，那么 PHPUnit 将忽略该方法。</p>
<p>在我们第一次运行测试套件之前，有必要指出 Laravel 提供的默认 phpunit.xml 文件。 PHPUnit 在运行时会自动在当前目录中查找名为 phpunit.xml 或者 phpunit.xml.dist 的文件。您可以在此处配置测试的特定选项。</p>
<p>这个文件中有很多信息，但是现在最重要的部分是在 testsuite 目录定义：</p>
<p>&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;</p>
<phpunit ...>

    <testsuites>
        <testsuite name="Application Test Suite">
            <directory>./tests/</directory>
        </testsuite>
    </testsuites>

    ...
</phpunit>

<p>这将告诉 PHPUnit 运行时在 ./tests/ 目录中找到的测试，正如我们之前所知，这是存储测试的约定。</p>
<p>现在我们已经创建了一个基本测试，并且知道了 PHPUnit 配置，现在是第一次运行测试的时候了。</p>
<p>您可以通过运行以下 phpunit 命令来运行测试：</p>
<p>./vendor/bin/phpunit</p>
<p>您应该看到与此类似的输出：</p>
<p>PHPUnit 4.8.19 by Sebastian Bergmann and contributors.</p>
<p>..</p>
<p>Time: 103 ms, Memory: 12.75Mb</p>
<p>OK (2 tests, 3 assertions)</p>
<p>现在我们已经有了一个有效的 PHPUnit 设置，现在是时候开始编写一个基本测试了。</p>
<p>注意，它会统计2个测试和3个断言，因为 ExampleTest.php 文件包含了一个带有两个断言的测试。我们的新基本测试包括一个单独的断言，该断言已通过。</p>
<p>写一个基础测试<br>为了帮助 PHPUnit 提供的基本断言,我们将首先创建一个提供一些简单功能的基本类</p>
<p>在 ./app/ 目录中创建一个名为 Box.php 的新文件，并复制此示例类：</p>
<p>&lt;?php<br>namespace App;</p>
<p>class Box<br>{<br>    /**</p>
<pre><code>* @var array
*/
protected $items = [];

/**
* 使用给定项构造框
*
* @param array $items
*/
public function __construct($items = [])
{
    $this-&gt;items = $items;
}

/**
* 检查指定的项目是否在框中。
*
* @param string $item
* @return bool
*/
public function has($item)
{
    return in_array($item, $this-&gt;items);
}

/**
* 从框中移除项，如果框为空，则为 null 。
*
* @return string
*/
public function takeOne()
{
    return array_shift($this-&gt;items);
}

/**
* 从包含指定字母开头的框中检索所有项目。
*
* @param string $letter
* @return array
*/
public function startsWith($letter)
{
    return array_filter($this-&gt;items, function ($item) use ($letter) {
        return stripos($item, $letter) === 0;
    });
}
</code></pre><p>}</p>
<p>接下来， 打开你的 ./tests/BasicTest.php 类（我们之前创建的类），并删除默认创建的 testExample 方法， 你应该留一个空类。</p>
<p>我们现在将使用七个基本的 PHPUnit 断言来为我们的 Box 类编写测试。这些断言是：</p>
<p>assertTrue()<br>assertFalse()<br>assertEquals()<br>assertNull()<br>assertContains()<br>assertCount()<br>assertEmpty()<br>assertTrue() 和 assertFalse()<br>assertTrue() 和 assertFalse() 允许你声明一个值等于 true 或 false 。这意味着它们非常适合测试返回布尔值的方法。在我们的 Box 类中，我们有一个名为 has($item) 的方法，当指定的项在 box 中或不在 box 中时，该方法返回对应返回 true 或 false .</p>
<p>要在 PHPUnit 中为此编写测试，我们可以执行以下操作：</p>
<p>&lt;?php<br>use App\Box;</p>
<p>class BasicTest extends TestCase<br>{<br>    public function testHasItemInBox()<br>    {<br>        $box = new Box([‘cat’, ‘toy’, ‘torch’]);</p>
<pre><code>    $this-&gt;assertTrue($box-&gt;has(&#39;toy&#39;));
    $this-&gt;assertFalse($box-&gt;has(&#39;ball&#39;));
}
</code></pre><p>}</p>
<p>注意我们如何只将一个参数传递给 assertTrue() 和 assertFalse() 方法，并且它是 has($item) 方法的输入.</p>
<p>如果您现在运行 ./vendor/bin/phpunit 命令，您会注意到输出包括：</p>
<p>OK (2 tests, 4 assertions)</p>
<p>这意味着我们的测试已经通过。</p>
<p>如果您将 assertFalse() 替换成 assertTrue() 并运行 phpunit 命令，输出将如下所示：</p>
<p>PHPUnit 4.8.19 by Sebastian Bergmann and contributors.</p>
<p>F.</p>
<p>Time: 93 ms, Memory: 13.00Mb</p>
<p>There was 1 failure:</p>
<p>1) BasicTest::testHasItemInBox<br>Failed asserting that false is true.</p>
<p>./tests/BasicTest.php:12</p>
<p>FAILURES!<br>Tests: 2, Assertions: 4, Failures: 1.</p>
<p>这告诉我们第12行的断言未能断言 false 值是 true - 因为我们将 assertFalse() 替换为 assertTrue() 。</p>
<p>将其交换回来，然后重新运行 PHPUnit 。测试应该再次通过，因为我们已经修复了破损的测试。</p>
<p>assertEquals() 与 assertNull()<br>接下来，让我们看看 assertEquals(), 以及 assertNull()。</p>
<p>assertEquals() 用于比较变量实际值与预期值是否相等。我们用它来检查 takeOne() 方法的返回值是否为 Box 内的当前值。当 Box 为空时，takeOne() 将返回 null，我们亦可使用 assertNull() 来进行检查。</p>
<p>与 assertTrue()、assertFalse() 以及 assertNull() 不同，assertEquals() 需要两个参数。第一个参数为 预期 值，第二个参数则为 实际 值。</p>
<p>可参照如下代码实现以上断言（assertions）：</p>
<p>&lt;?php<br>use App\Box;</p>
<p>class BasicTest extends TestCase<br>{<br>    public function testHasItemInBox()<br>    {<br>        $box = new Box([‘cat’, ‘toy’, ‘torch’]);</p>
<pre><code>    $this-&gt;assertTrue($box-&gt;has(&#39;toy&#39;));
    $this-&gt;assertFalse($box-&gt;has(&#39;ball&#39;));
}

public function testTakeOneFromTheBox()
{
    $box = new Box([&#39;torch&#39;]);

    $this-&gt;assertEquals(&#39;torch&#39;, $box-&gt;takeOne());

    // 当前 Box 为空，应当为 Null
    $this-&gt;assertNull($box-&gt;takeOne());
}
</code></pre><p>}</p>
<p>运行 phpunit 命令，你应当看到如下输出：</p>
<p>OK (3 tests, 6 assertions)</p>
<p>assertContains() 和 assertCount() 以及 assertEmpty()<br>终于，我们有三个作用于数组有关的断言，我们能够使用它们去检查 Box 类中的 startsWith($item) 方法。 assertContains() 断言传递进来的数组中包含指定值， assertCount() 断言数组的项数为指定数量，assertEmpty() 断言传递进来的数组为空。</p>
<p>让我们来执行以下测试：</p>
<p>&lt;?php<br>use App\Box;</p>
<p>class BasicTest extends TestCase<br>{<br>    public function testHasItemInBox()<br>    {<br>        $box = new Box([‘cat’, ‘toy’, ‘torch’]);</p>
<pre><code>    $this-&gt;assertTrue($box-&gt;has(&#39;toy&#39;));
    $this-&gt;assertFalse($box-&gt;has(&#39;ball&#39;));
}

public function testTakeOneFromTheBox()
{
    $box = new Box([&#39;torch&#39;]);

    $this-&gt;assertEquals(&#39;torch&#39;, $box-&gt;takeOne());

    // Null，现在这个 box 是空的。
    $this-&gt;assertNull($box-&gt;takeOne());
}

public function testStartsWithALetter()
{
    $box = new Box([&#39;toy&#39;, &#39;torch&#39;, &#39;ball&#39;, &#39;cat&#39;, &#39;tissue&#39;]);

    $results = $box-&gt;startsWith(&#39;t&#39;);

    $this-&gt;assertCount(3, $results);
    $this-&gt;assertContains(&#39;toy&#39;, $results);
    $this-&gt;assertContains(&#39;torch&#39;, $results);
    $this-&gt;assertContains(&#39;tissue&#39;, $results);

    // 如果传递复数断言数组为空
    $this-&gt;assertEmpty($box-&gt;startsWith(&#39;s&#39;));
}
</code></pre><p>}</p>
<p>保存并再一次运行你的测试：</p>
<p>OK (4 tests, 9 assertions)</p>
<p>恭喜你，你刚刚使用七个基础的 PHPUnit 断言完成了对 Box 类的全部测试。通过这些简单的断言你能够做许多事，对于其他断言，大多数要更复杂，不过它们仍遵循以上使用规则。</p>
<p>测试你的程序<br>在你的程序里，对每个组件进行单元测试在很多情况下都是有必要的，而且也应该成为你开发过程中必不可少的一部分，但这并不是你需要做的全部的测试。当你构建一个包含复杂视图、导航和表单的程序时，你同样想测试这些组件。这时，Laravel的测试助手可以使这些测试像单元测试简单组件一样容易。</p>
<p>我们之前查看在 ./tests/ 目录下的默认文件时跳过了 ./tests/ExampleTest.php 文件。 现在打开它，内容如下所示：</p>
<p>&lt;?php<br>class ExampleTest extends TestCase<br>{<br>    /**</p>
<ul>
<li>一个基本功能测试示例。<br>*</li>
<li>@return void<br>*/<br>  public function testBasicExample()<br>  {<pre><code>  $this-&gt;visit(&#39;/&#39;)
       -&gt;see(&#39;Laravel 5&#39;);
</code></pre>  }<br>}</li>
</ul>
<p>我们可以看到这个测试示例非常简单。在不知道测试助手如何运作的情况下，我们可以猜测它的意思如下：</p>
<p>当我访问/ (根目录)<br>我应该看到 ‘Laravel 5’<br>如果你打开你的web浏览器，访问我们的程序（如果你没有启动你的web服务器，你可以运行 php artisan serve ），你应该可以在web根目录上看到屏幕上有“Laravel 5”的文本。 鉴于这个测试已经通过了PHPUnit，我们可以很确定地说我们对这个测试示例改造是正确的。</p>
<p>这个测试确保了访问/路径，网页可以返回“’Laravel 5”的文本。一个如此简单的检查也许不代表什么，但如果你的网站上要显示关键信息，它就可以在一个别处的改动导致这个页面无法正常显示正确的信息时，防止你部署一个被损坏的程序。</p>
<p>visit()、see() 以及 dontSee()<br>现在尝试编写自己的测试，更进一步理解它吧。</p>
<p>首先，编辑 ./app/Http/routes.php ，增加一个新的路由。为了教程目的，我们创建希腊字母定义的路由：</p>
<p>&lt;?php<br>Route::get(‘/‘，function () {<br>    return view(‘welcome’);<br>});</p>
<p>Route::get(‘/alpha’，function () {<br>    return view(‘alpha’);<br>});</p>
<p>然后，创建视图文件 ./resources/views/alpha.blade.php，使用 Alpha 作为关键字，保存基本的HTML文件：</p>
<p>&lt;!DOCTYPE html&gt;</p>
<html>
    <head><meta name="generator" content="Hexo 3.9.0">
        <title>Alpha</title>
    </head>
    <body>
        <p>This is the Alpha page.</p>
    </body>
</html>

<p>打开浏览器，输入网址: <a href="http://localhost:8000/beta，页面会显示出" target="_blank" rel="noopener">http://localhost:8000/beta，页面会显示出</a> “This is the Alpha page.” 的内容。</p>
<p>现在我们有了测试用到的模版文件，下一步，我们通过运行命令 make:test 来创建一个新的测试文件：</p>
<p>php artisan make:test AlphaTest</p>
<p>然后变成刚创建好的测试文件，按照框架提供的例子，测试 “alpha” 页面上没有包含 “beta” 。 我们可以使用方法 dontSee() ，它是 see() 的对应的反向方法。</p>
<p>下面代码是上面实现的简单例子：</p>
<p>&lt;?php<br>class AlphaTest extends TestCase<br>{<br>    public function testDisplaysAlpha()<br>    {<br>        $this-&gt;visit(‘/alpha’)<br>             -&gt;see(‘Alpha’)<br>             -&gt;dontSee(‘Beta’);<br>    }<br>}</p>
<p>保存并运行 PHPUnit (./vendor/bin/phpunit)，测试代码应该会全部通过，你会看到像这样的测试状态内容显示：</p>
<p>OK (5 tests，12 assertions)</p>
<p>开发前先写测试<br>对于测试来说，测试驱动开发 (TDD) 是非常酷的方法，首先我们先写测试。写完测试并执行它们，你会发现测试没通过，接下来 我们编写满足测试的代码，再次执行测试，使测试通过。 接下来让我们开始。</p>
<p>首先，建立一个 BetaTest 类使用 make:test artisan 命令：</p>
<p>php artisan make:test BetaTest</p>
<p>接下来，更新测试用例以便检查 /beta 的路由 route 为「Beta」：</p>
<p>&lt;?php<br>class BetaTest extends TestCase<br>{<br>    public function testDisplaysBeta()<br>    {<br>        $this-&gt;visit(‘/beta’)<br>             -&gt;see(‘Beta’)<br>             -&gt;dontSee(‘Alpha’);<br>    }<br>}</p>
<p>现在使用 ./vendor/bin/phpunit 命令来执行测试。结果是一个看起来简洁但不好的错误信息，如下：</p>
<blockquote>
<p>./vendor/bin/phpunit<br>PHPUnit 4.8.19 by Sebastian Bergmann and contributors.</p>
</blockquote>
<p>….F.</p>
<p>Time: 144 ms, Memory: 14.25Mb</p>
<p>There was 1 failure:</p>
<p>1) BetaTest::testDisplaysBeta<br>一个对 [<a href="http://localhost/beta" target="_blank" rel="noopener">http://localhost/beta</a>] 的请求失败了。收到状态码 [404]。</p>
<p>…</p>
<p>FAILURES!<br>Tests: 6, Assertions: 13, Failures: 1.</p>
<p>我们现在需要创建这个不存在的路由。让我们开始。</p>
<p>首先，编辑 ./app/Http/routes.php 文件来创建新的 /beta 路由：</p>
<p>&lt;?php<br>Route::get(‘/‘, function () {<br>    return view(‘welcome’);<br>});</p>
<p>Route::get(‘/alpha’, function () {<br>    return view(‘alpha’);<br>});</p>
<p>Route::get(‘/beta’, function () {<br>    return view(‘beta’);<br>});</p>
<p>接下来，在 ./resources/views/beta.blade.php 下创建如下视图模版：</p>
<p>&lt;!DOCTYPE html&gt;</p>
<html>
    <head><meta name="generator" content="Hexo 3.9.0">
        <title>Beta</title>
    </head>
    <body>
        <p>This is the Beta page.</p>
    </body>
</html>

<p>现在再一次执行 PHPUnit，结果应该再一次回到绿色。</p>
<blockquote>
<p>./vendor/bin/phpunit<br>PHPUnit 4.8.19 by Sebastian Bergmann and contributors.</p>
</blockquote>
<p>……</p>
<p>Time: 142 ms, Memory: 14.00Mb</p>
<p>OK (6 tests, 15 assertions)</p>
<p>这样我们就通过在完成新的页面之前写测试的方式，对 测试驱动开发 进行了实践。</p>
<p>click() 和 seePageIs()<br>Laravel 也提供一个辅助函数 (click()) 允许测试点击页面中存在的连接 ，以及一个方法 (seePageIs()) 检查点击展示的结果页面。</p>
<p>让我们使用这两个辅助函数去执行在 Alpha 和 Beta 页面的链接。</p>
<p>首先，我们更新我们的测试。打开 AlphaTest 类，我们将添加一个新的测试方法，这将点击 「alpha」页面上的「Next」链接跳转到 「beta」页面。</p>
<p>新的测试代码如下：</p>
<p>&lt;?php<br>class AlphaTest extends TestCase<br>{<br>    public function testDisplaysAlpha()<br>    {<br>        $this-&gt;visit(‘/alpha’)<br>             -&gt;see(‘Alpha’)<br>             -&gt;dontSee(‘Beta’);<br>    }</p>
<pre><code>public function testClickNextForBeta()
{
    $this-&gt;visit(&#39;/alpha&#39;)
         -&gt;click(&#39;Next&#39;)
         -&gt;seePageIs(&#39;/beta&#39;);
}
</code></pre><p>}</p>
<p>注意到，在我们新建的 testClickNextForBeta() 方法中，我们并没有检查每一个页面的内容。 其他测试都成功的检查了两个页面的内容，所以这里我们只关心点击 「Next」链接将发送到 /beta。</p>
<p>你现在可以运行测试组件了，但就像预料的一样测试将不通过，因为我们还没有更新我们的 HTML。</p>
<p>接下来，我们将更新 BetaTest 来做类似的事情：</p>
<p>&lt;?php<br>class BetaTest extends TestCase<br>{<br>    public function testDisplaysBeta()<br>    {<br>        $this-&gt;visit(‘/beta’)<br>             -&gt;see(‘Beta’)<br>             -&gt;dontSee(‘Alpha’);<br>    }</p>
<pre><code>public function testClickNextForAlpha()
{
    $this-&gt;visit(&#39;/beta&#39;)
         -&gt;click(&#39;Previous&#39;)
         -&gt;seePageIs(&#39;/alpha&#39;);
}
</code></pre><p>}</p>
<p>接下来，我们更新我们的 HTML 模版。</p>
<p>./resources/views/alpha.blade.php：</p>
<p>&lt;!DOCTYPE html&gt;</p>
<html>
    <head><meta name="generator" content="Hexo 3.9.0">
        <title>Alpha</title>
    </head>
    <body>
        <p>This is the Alpha page.</p>
        <p><a href="/beta">Next</a></p>
    </body>
</html>

<p>./resources/views/beta.blade.php：</p>
<p>&lt;!DOCTYPE html&gt;</p>
<html>
    <head><meta name="generator" content="Hexo 3.9.0">
        <title>Beta</title>
    </head>
    <body>
        <p>This is the Beta page.</p>
        <p><a href="/alpha">Previous</a></p>
    </body>
</html>

<p>保存文件，再一次执行 PHPUnit：</p>
<blockquote>
<p>./vendor/bin/phpunit<br>PHPUnit 4.8.19 by Sebastian Bergmann and contributors.</p>
</blockquote>
<p>F….F..</p>
<p>Time: 175 ms, Memory: 14.00Mb</p>
<p>There were 2 failures:</p>
<p>1) AlphaTest::testDisplaysAlpha<br>Failed asserting that ‘&lt;!DOCTYPE html&gt;</p>
<p><html>
    <head><meta name="generator" content="Hexo 3.9.0">
        <title>Alpha</title>
    </head>
    <body>
        <p>This is the Alpha page.</p>
        <p><a href="/beta">Next</a></p>
    </body>
</html><br>‘ does not match PCRE pattern “/Beta/i”.</p>
<p>2) BetaTest::testDisplaysBeta<br>Failed asserting that ‘&lt;!DOCTYPE html&gt;</p>
<p><html>
    <head><meta name="generator" content="Hexo 3.9.0">
        <title>Beta</title>
    </head>
    <body>
        <p>This is the Beta page.</p>
        <p><a href="/alpha">Previous</a></p>
    </body>
</html><br>‘ does not match PCRE pattern “/Alpha/i”.</p>
<p>FAILURES!<br>Tests: 8, Assertions: 23, Failures: 2.</p>
<p>然而测试失败了。如果你仔细观察我们的新 HTML，你将注意到我们分别有术语 beta 和 alpha 在 /alpha 和 /beta 页面。这意味着我们需要稍微更改我们的测试让它们与误报不匹配。</p>
<p>在每一个 AlphaTest 和 BetaTest 类，更新 testDisplays* 方法去使用 dontSee(‘<page> page’)。通过这种方式，这将仅仅匹配字符串而不是那个术语。</page></p>
<p>两个测试文件如下所示：</p>
<p>./tests/AlphaTest.php：</p>
<p>&lt;?php<br>class AlphaTest extends TestCase<br>{<br>    public function testDisplaysAlpha()<br>    {<br>        $this-&gt;visit(‘/alpha’)<br>             -&gt;see(‘Alpha’)<br>             -&gt;dontSee(‘Beta page’);<br>    }</p>
<pre><code>public function testClickNextForBeta()
{
    $this-&gt;visit(&#39;/alpha&#39;)
         -&gt;click(&#39;Next&#39;)
         -&gt;seePageIs(&#39;/beta&#39;);
}
</code></pre><p>}</p>
<p>./tests/BetaTest.php：</p>
<p>&lt;?php<br>class BetaTest extends TestCase<br>{<br>    public function testDisplaysBeta()<br>    {<br>        $this-&gt;visit(‘/beta’)<br>             -&gt;see(‘Beta’)<br>             -&gt;dontSee(‘Alpha page’);<br>    }</p>
<pre><code>public function testClickNextForAlpha()
{
    $this-&gt;visit(&#39;/beta&#39;)
         -&gt;click(&#39;Previous&#39;)
         -&gt;seePageIs(&#39;/alpha&#39;);
}
</code></pre><p>}</p>
<p>再一次运行你的测试，所有的测试都应该通过了。我们现在已经测试我们所有的新文件，包括页面中的 Next/Previous 链接。</p>
<p>通过 Semaphore 对 PHPUnit 持续集成<br>通过 Semaphore设置 持续集成你可以自动执行你的测试。</p>
<p>这样每一次你进行 git push 提交代码的时候都会执行你的测试，并且 Semaphore 预装了所有最新的 PHP 版本。</p>
<p>如果你还没有一个 Semaphore 账户， 先去 注册一个免费的 Semaphore 账户 。接下来需要做的是将它 添加到你的项目，并按照提示逐步去做来执行你的测试：</p>
<p>composer install —prefer-source<br>phpunit</p>
<p>关于 PHP 持续集成 的更多信息，请参照 Semaphore 文档。</p>
<p>结语<br>你应该注意到本教程中的所有测试都有一个共同的主题：它们都非常简单。 这是学习如何使用基本的测试断言和辅助函数，并且尽可能的使用它们的好处之一。编写测试越简单，测试就越容易理解和维护。</p>
<p>掌握了本教程中介绍的 PHPUnit 断言之后，你还可以去 PHPUnit 文档 找到更多内容。 所有的断言都遵循基本的模式，但你会发现，在大多数测试中都会返回基本的断言。</p>
<p>对于 PHPUnit 断言来说，Laravel 的测试辅助函数是极好的补充，这让应用程序的测试变的非常容易。也就是说，重要的是要认识到，对于我们写测试，我们只检查关键信息，而不是整个页面。这使得测试变得简单，并允许页面内容随着应用程序的变化而变化。如果关键信息仍然存在，测试仍然通过，每个人都会满意。</p>
<p>在 Laravel 中基于 PHPUnit 进行代码测试：单元测试篇<br>由 学院君 创建于1年前, 最后更新于 5个月前    版本号 #1    5305 views    2 likes    0 collects<br>简介<br>介绍完 PHPUnit 的基本使用和 Laravel 框架自带的编排文件 phpunit.xml 文件，今天开始我们正式准备在 Laravel 项目中基于 PHPUnit 编写单元测试和功能测试，通过上篇教程介绍的编排文件我们知道，Laravel 的单元测试用例位于 tests/Unit 目录下，框架本身也为我们提供了一个示例测试文件 ExampleTest.php：</p>
<p>1<br>&lt;?php<br>2<br>​<br>3<br>namespace Tests\Unit;<br>4<br>​<br>5<br>use Tests\TestCase;<br>6<br>use Illuminate\Foundation\Testing\RefreshDatabase;<br>7<br>​<br>8<br>class ExampleTest extends TestCase<br>9<br>{<br>10<br>    /**<br>11</p>
<pre><code> * A basic test example.
</code></pre><p>12<br>     *<br>13</p>
<pre><code> * @return void
</code></pre><p>14<br>     */<br>15<br>    public function testBasicTest()<br>16<br>    {<br>17<br>        $this-&gt;assertTrue(true);<br>18<br>    }<br>19<br>}<br>其中包含了一行最基本的断言测试，用于判断指定的参数是否为真，并且这个测试永远是通过的。Laravel 的单元测试其实是原原本本继承了 PHPUnit 的单元测试功能，这里的父类 Tests\TestCase 从根源上继承自 PHPUnit\Framework\TestCase，所以我们可以在测试用例中使用所有 PHPUnit 支持的断言方法和测试注解。</p>
<p>下面我们通过几个常见的场景介绍下如何基于 PHPUnit 编写单元测试。</p>
<p>对变量进行测试<br>PHPUnit 底层提供了很多断言方法用于对变量进行测试，这些变量通常是业务代码类方法或函数的返回值，我们在 Unit\ExampleTest 中新增一个 testVariables 方法：</p>
<p>1<br>public function testVariables()<br>2<br>{<br>3<br>    $bool = false;<br>4<br>    $number = 100;<br>5<br>    $arr = [‘Laravel’, ‘PHP’, ‘学院君’];<br>6<br>    $obj = null;<br>7<br>​<br>8<br>    // 断言变量值是否为假，与 assertTrue 相对<br>9<br>    $this-&gt;assertFalse($bool);<br>10<br>    // 断言给定变量值是否与期望值相等，与 assertNotEquals 相对<br>11<br>    $this-&gt;assertEquals(100, $number);<br>12<br>    // 断言数组中是否包含给定值，与 assertNotContains 相对<br>13<br>    $this-&gt;assertContains(‘学院君’, $arr);<br>14<br>    // 断言数组长度是否与期望值相等，与 assertNotCount 相对<br>15<br>    $this-&gt;assertCount(3, $arr);<br>16<br>    // 断言数组是否不会空，与 assertEmpty 相对<br>17<br>    $this-&gt;assertNotEmpty($arr);<br>18<br>    // 断言变量是否为 null，与 assertNotNull 相对<br>19<br>    $this-&gt;assertNull($obj);<br>20<br>}<br>相应的断言用途在注释中已经说明了，我们可以对各种类型的变量从各种维度进行断言，甚至还可以对文件、目录、正则表达式进行断言，并且很多断言都可以从正反两个方法进行，相关的调用都很简单，你可以在需要的时候查看官方文档选择相应的断言方法：<a href="https://phpunit.readthedocs.io/zh_CN/latest/assertions.html。" target="_blank" rel="noopener">https://phpunit.readthedocs.io/zh_CN/latest/assertions.html。</a></p>
<p>运行上面的测试用例，结果如下，每个测试方法都代表一个测试用例，所以上面的单元测试包含两个测试用例，7个断言：</p>
<p>对输出进行测试<br>除了对变量进行测试外，还可以对页面输出进行测试，这可以通过 PHPUnit 提供的 expectOutputString 方法来实现：</p>
<p>1<br>public function testOutput()<br>2<br>{<br>3<br>    $this-&gt;expectOutputString(‘学院君’);<br>4<br>    echo ‘学院君’;<br>5<br>}<br>此外还可以对输出数据进行正则判断：</p>
<p>1<br>public function testOutputRegex()<br>2<br>{<br>3<br>    $this-&gt;expectOutputRegex(‘/Laravel/i’);<br>4<br>    echo ‘Laravel学院’;<br>5<br>}<br>上述测试结果都是通过的：</p>
<p>对异常进行测试<br>类似的，还可以通过 expectException 方法对异常进行测试，为了让测试用例更加符合真实场景，我们在 app 目录下新增一个 Services 子目录，然后在该子目录下创建一个 TestService 类并初始化代码如下：</p>
<p>1<br>&lt;?php<br>2<br>namespace App\Services;<br>3<br>​<br>4<br>class TestService<br>5<br>{<br>6<br>    public function invalidArgument()<br>7<br>    {<br>8<br>        throw new \InvalidArgumentException(‘无效的参数’);<br>9<br>    }<br>10<br>}<br>然后回到 Unit\ExampleTest，编写一个新的测试用例如下：</p>
<p>1<br>public function testException()<br>2<br>{<br>3<br>    $this-&gt;expectException(\InvalidArgumentException::class);<br>4<br>    $service = new TestService();<br>5<br>    $service-&gt;invalidArgument();<br>6<br>}<br>运行测试用例，结果为通过：</p>
<p>如果传入的抛出异常类的是父类，也会通过：</p>
<p>1<br>$this-&gt;expectException(\Exception::class);<br>除此之外，还可以进一步对异常明细进行测试，比如通过 expectExceptionCode()、expectExceptionMessage() 和 expectExceptionMessageRegExp() 方法可以用于测试异常码、异常信息。</p>
<p>除了通过上述方法，还可以通过注解对异常进行测试，这种方式更加方便：</p>
<p>1<br>/**<br>2</p>
<ul>
<li>@expectedException \InvalidArgumentException<br>3<br>*/<br>4<br>public function testExceptionAnnotation()<br>5<br>{<br>6<br> $this-&gt;service-&gt;invalidArgument();<br>7<br>}<br>由于两个测试用例中都用到了 TestService，所以我们将其在 setUp 方法进行初始化：</li>
</ul>
<p>1<br>/**<br>2</p>
<ul>
<li>@var TestService<br>3<br>*/<br>4<br>protected $service;<br>5<br>​<br>6<br>protected function setUp(): void<br>7<br>{<br>8<br> parent::setUp();<br>9<br> $this-&gt;service = new TestService();<br>10<br>}<br>上面两个测试用例从功能上说是等价的：</li>
</ul>
<p>对错误进行测试<br>默认情况下，PHPUnit 会将 PHP 错误、警告和通知都转化为异常，在上一篇 PHP 编排文件 phpunit.xml 中我们提到，Laravel 也默认配置为做这些转化，所以我们可以通过测试异常的方式对业务代码中的错误进行测试。具体用法和异常测试一样，就不再赘述了。</p>
<p>测试的依赖关系<br>有的时候，我们需要测试的两个用例之间可能有依赖关系，比如我们在 TestService 定义如下个方法：</p>
<p>1<br>protected $stack = [];<br>2<br>​<br>3<br>public function init()<br>4<br>{<br>5<br>    $this-&gt;stack = [‘学院君’, ‘Laravel学院’, ‘单元测试’];<br>6<br>}<br>7<br>​<br>8<br>public function stackContains($value)<br>9<br>{<br>10<br>    return in_array($value, $this-&gt;stack);<br>11<br>}<br>12<br>​<br>13<br>public function getStackSize()<br>14<br>{<br>15<br>    return count($this-&gt;stack);<br>16<br>}<br>我们在测试 stackContains 方法时，往往要先调用 init 方法，但是在单元测试中，每个方法都有独立的测试用例，如果多次调用有可能会对数据造成污染，那我们能否在 init 方法测试用例的运行基础上运行 stackContains 方法的测试用例呢？这个时候，我们说这两个测试用例之间是具有依赖关系的，PHPUnit 中通过 @depends 注解对这种依赖关系进行了支持，我们可以在 Unit\ExampleTest 中编写测试用例如下：</p>
<p>1<br>public function testInitStack()<br>2<br>{<br>3<br>    $this-&gt;service-&gt;init();<br>4<br>    $this-&gt;assertEquals(3, $this-&gt;service-&gt;getStackSize());<br>5<br>​<br>6<br>    return $this-&gt;service;<br>7<br>}<br>8<br>​<br>9<br>/**<br>10</p>
<ul>
<li>@depends testInitStack<br>11</li>
<li>@param TestService $service<br>12<br>*/<br>13<br>public function testStackContains(TestService $service)<br>14<br>{<br>15<br> $contains = $service-&gt;stackContains(‘学院君’);<br>16<br> $this-&gt;assertTrue($contains);<br>17<br>}<br>在 testStackContains 用例中，我们将 testInitStack 用例返回的 $service 实例传递进来，并在此基础上进行测试。</li>
</ul>
<p>数据提供器<br>除了支持测试用例之间的依赖之外，PHPUnit 还可以通过 @dataProvider 注解为多个测试用例提供初始化数据：</p>
<p>1<br>public function initDataProvider()<br>2<br>{<br>3<br>    return [<br>4<br>        [‘学院君’],<br>5<br>        [‘Laravel学院’]<br>6<br>    ];<br>7<br>}<br>8<br>​<br>9<br>/**<br>10</p>
<ul>
<li>@depends testInitStack<br>11</li>
<li>@dataProvider initDataProvider<br>12<br>*/<br>13<br>public function testIsStackContains()<br>14<br>{<br>15<br> $arguments = func_get_args();<br>16<br> $service = $arguments[1];<br>17<br> $value = $arguments[0];<br>18<br> $this-&gt;assertTrue($service-&gt;stackContains($value));<br>19<br>}<br>在这个测试用例中，我们通过 initDataProvider 方法作为数据提供器，数据供给器方法必须声明为 public，其返回值要么是一个数组，其每个元素也是数组；要么是一个实现了 Iterator 接口的对象，在对它进行迭代时每步产生一个数组。每个数组都是测试数据集的一部分，将以它的内容作为参数来调用测试方法。</li>
</ul>
<p>然后我们在需要用到这个数据提供器的测试用例上用 @dataProvider 注解进行声明，在这个示例中我们迭代数据提供器数组，将其中的数据作为参数传入 TestService 的 stackContains 方法以判断对应值在 stack 属性中是否存在。</p>
<p>以下是上述用例运行结果：</p>
<p>关于 Laravel 基于 PHPUnit 编写单元测试用例我们就简单介绍到这里，在这篇教程中我们基本上使用的都是 PHPUnit 提供的原生测试功能，下一篇我们将围绕 Laravel 功能测试展开，主要是对控制器和 API 接口的测试，在那里，我们将开始就 Laravel 框架在 PHPUnit 基础上封装的新功能新特性进行介绍。</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Laravel/" rel="tag"># Laravel</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/04/27/array-column-recursive/" rel="next" title="array_column_recursive">
                <i class="fa fa-chevron-left"></i> array_column_recursive
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Chebin"/>
            
              <p class="site-author-name" itemprop="name">Chebin</p>
              <div class="site-description motion-element" itemprop="description">记录自己的学习过程</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">423</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">65</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          


          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <!-- modify icon to fire by szw -->
                <i class="fa fa-history fa-" aria-hidden="true"></i>
                近期文章
              </div>
              <ul class="links-of-blogroll-list">
                
                
                  <li>
                    <a href="/2020/04/28/Laravel的单元测试/" title="Laravel的单元测试" target="_blank">Laravel的单元测试</a>
                  </li>
                
                  <li>
                    <a href="/2020/04/27/array-column-recursive/" title="array_column_recursive" target="_blank">array_column_recursive</a>
                  </li>
                
                  <li>
                    <a href="/2020/04/27/如何实现IoC容器和服务提供者是什么概念/" title="如何实现IoC容器和服务提供者是什么概念" target="_blank">如何实现IoC容器和服务提供者是什么概念</a>
                  </li>
                
                  <li>
                    <a href="/2020/04/27/依赖注入、控制反转、反射各个概念的理解和使用/" title="依赖注入、控制反转、反射各个概念的理解和使用" target="_blank">依赖注入、控制反转、反射各个概念的理解和使用</a>
                  </li>
                
                  <li>
                    <a href="/2020/04/25/tag解析机制/" title="tag解析机制" target="_blank">tag解析机制</a>
                  </li>
                
              </ul>
            </div>
        

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#PHPUnit"><span class="nav-number">1.</span> <span class="nav-text">PHPUnit</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Laravel的单元测试"><span class="nav-number">2.</span> <span class="nav-text">Laravel的单元测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建一个新的测试"><span class="nav-number">2.1.</span> <span class="nav-text">创建一个新的测试</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chebin</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">4.4m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">66:21</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
