<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">





















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="思考并回答以下问题：  集合是“macroable”的是什么意思？">
<meta name="keywords" content="Laravel">
<meta property="og:type" content="article">
<meta property="og:title" content="Laravel-Collection">
<meta property="og:url" content="http://chebincarl.github.io/2020/04/12/Laravel-Collection/index.html">
<meta property="og:site_name" content="车斌的博客">
<meta property="og:description" content="思考并回答以下问题：  集合是“macroable”的是什么意思？">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-04-12T14:09:26.844Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Laravel-Collection">
<meta name="twitter:description" content="思考并回答以下问题：  集合是“macroable”的是什么意思？">






  <link rel="canonical" href="http://chebincarl.github.io/2020/04/12/Laravel-Collection/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Laravel-Collection | 车斌的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">车斌的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">专注，重复10遍</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chebincarl.github.io/2020/04/12/Laravel-Collection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chebin">
      <meta itemprop="description" content="记录自己的学习过程">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="车斌的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Laravel-Collection

              
            
          </h1>
        

        <div class="post-meta">

          

          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-04-12 11:20:58 / 修改时间：22:09:26" itemprop="dateCreated datePublished" datetime="2020-04-12T11:20:58+08:00">2020-04-12</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">47k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">43 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>思考并回答以下问题：</p>
<ul>
<li>集合是“macroable”的是什么意思？</li>
</ul>
<a id="more"></a>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a><span style="color:#339AFF;">简介</span></h1><p>Illuminate\Support\Collection类为处理数组数据提供了流式、方便的封装。例如，查看下面的代码，我们使用辅助函数collect创建一个新的集合实例，为每一个元素运行strtoupper函数，然后移除所有空元素：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'taylor'</span>, <span class="string">'abigail'</span>, <span class="keyword">null</span>])-&gt;map(<span class="function"><span class="keyword">function</span> <span class="params">($name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> strtoupper($name);</span><br><span class="line">&#125;)-&gt;reject(<span class="function"><span class="keyword">function</span> <span class="params">($name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">empty</span>($name);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>正如你所看到的，Collection类允许你使用方法链对底层数组执行匹配和移除操作，通常，每个Collection方法都会返回一个新的Collection实例。</p>
<h2 id="创建集合"><a href="#创建集合" class="headerlink" title="创建集合"></a><span style="color:#00ACC1;">创建集合</span></h2><p>正如上面所提到的，辅助函数collect为给定数组返回一个新的Illuminate\Support\Collection实例，所以，创建集合很简单：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注：默认情况下，Eloquent查询的结果总是返回Collection实例。</p>
</blockquote>
<h2 id="扩展集合"><a href="#扩展集合" class="headerlink" title="扩展集合"></a><span style="color:#00ACC1;">扩展集合</span></h2><p>集合是“macroable”的，这意味着我们可以在运行时动态添加方法到Collection类，例如，下面的代码添加了toUpper方法到Collection类：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Str</span>;</span><br><span class="line"></span><br><span class="line">Collection::macro(<span class="string">'toUpper'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;map(<span class="function"><span class="keyword">function</span> <span class="params">($value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Str::upper($value);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection = collect([<span class="string">'first'</span>, <span class="string">'second'</span>]);</span><br><span class="line"></span><br><span class="line">$upper = $collection-&gt;toUpper();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['FIRST', 'SECOND']</span></span><br></pre></td></tr></table></figure></p>
<p>通常，我们需要在服务提供者中声明集合宏。</p>
<h1 id="集合方法"><a href="#集合方法" class="headerlink" title="集合方法"></a><span style="color:#339AFF;">集合方法</span></h1><p>本文档接下来的部分将会介绍Collection类上每一个有效的方法，所有这些方法都可以以方法链的方式流式操作底层数组。此外，几乎每个方法返回一个新的Collection实例，从而允许你在必要的时候保持原来的集合备份。</p>
<h1 id="方法列表"><a href="#方法列表" class="headerlink" title="方法列表"></a><span style="color:#339AFF;">方法列表</span></h1><p><strong>all()</strong></p>
<p>all方法简单返回集合表示的底层数组：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])-&gt;all();</span><br><span class="line"><span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<p><strong>avg()</strong></p>
<p>avg方法返回所有集合项的平均值：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$average = collect([[<span class="string">'foo'</span> =&gt; <span class="number">10</span>], [<span class="string">'foo'</span> =&gt; <span class="number">10</span>], [<span class="string">'foo'</span> =&gt; <span class="number">20</span>], [<span class="string">'foo'</span> =&gt; <span class="number">40</span>]])-&gt;avg(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 20</span></span><br><span class="line"></span><br><span class="line">$average = collect([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>])-&gt;avg();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p><strong>average()</strong></p>
<p>avg方法的别名。</p>
<p><strong>chunk()</strong></p>
<p>chunk方法将一个集合分割成多个小尺寸的小集合：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]);</span><br><span class="line">$chunks = $collection-&gt;chunk(<span class="number">4</span>);</span><br><span class="line">$chunks-&gt;toArray();</span><br><span class="line"><span class="comment">// [[1, 2, 3, 4], [5, 6, 7]]</span></span><br></pre></td></tr></table></figure>
<p>当处理栅栏系统如Bootstrap时该方法在视图中尤其有用，假设你有一个想要显示在栅栏中的Eloquent模型集合：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">foreach</span> ($products-&gt;chunk(<span class="number">3</span>) <span class="keyword">as</span> $chunk)</span><br><span class="line">    &lt;div class="row"&gt;</span><br><span class="line">        @<span class="keyword">foreach</span> ($chunk <span class="keyword">as</span> $product)</span><br><span class="line">            &lt;div class="col-xs-4"&gt;&#123;&#123; $product-&gt;name &#125;&#125;&lt;/div&gt;</span><br><span class="line">        @<span class="keyword">endforeach</span></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">@<span class="keyword">endforeach</span></span><br></pre></td></tr></table></figure>
<p><strong>collapse()</strong></p>
<p>collapse方法将一个多维数组集合收缩成一个一维数组：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]]);</span><br><span class="line">$collapsed = $collection-&gt;collapse();</span><br><span class="line">$collapsed-&gt;all();</span><br><span class="line"><span class="comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br></pre></td></tr></table></figure>
<p><strong>combine()</strong></p>
<p>combine方法可以将一个集合的键和另一个数组或集合的值连接起来：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'name'</span>, <span class="string">'age'</span>]);</span><br><span class="line"></span><br><span class="line">$combined = $collection-&gt;combine([<span class="string">'George'</span>, <span class="number">29</span>]);</span><br><span class="line"></span><br><span class="line">$combined-&gt;all();</span><br><span class="line"><span class="comment">// ['name' =&gt; 'George', 'age' =&gt; 29]</span></span><br></pre></td></tr></table></figure>
<p><strong>collect()</strong></p>
<p>collect方法返回一个新的包含当前元素的Collection实例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collectionA = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">$collectionB = $collectionA-&gt;collect();</span><br><span class="line"></span><br><span class="line">$collectionB-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<p>collect方法在将懒集合转化为标准Collection实例时很有用：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$lazyCollection = LazyCollection::make(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection = $lazyCollection-&gt;collect();</span><br><span class="line"></span><br><span class="line">get_class($collection);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 'Illuminate\Support\Collection'</span></span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注：collect方法在当你有一个Enumerable实例并且需要一个非懒集合实例时特别有用，由于collect()是Enumerable契约的一部分，所以你可以通过它安全获取一个Collection实例。</p>
</blockquote>
<p><strong>concat()</strong></p>
<p>concat方法可用于追加给定数组或集合数据到集合末尾：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'John Doe'</span>]);</span><br><span class="line"></span><br><span class="line">$concatenated = $collection-&gt;concat([<span class="string">'Jane Doe'</span>])-&gt;concat([<span class="string">'name'</span> =&gt; <span class="string">'Johnny Doe'</span>]);</span><br><span class="line"></span><br><span class="line">$concatenated-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['John Doe', 'Jane Doe', 'Johnny Doe']</span></span><br></pre></td></tr></table></figure>
<p><strong>contains()</strong></p>
<p>contains方法判断集合是否包含一个给定项：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'name'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;contains(<span class="string">'Desk'</span>);</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">$collection-&gt;contains(<span class="string">'New York'</span>);</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<p>你还可以传递一个键值对到contains方法，这将会判断给定键值对是否存在于集合中：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">200</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Chair'</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;contains(<span class="string">'product'</span>, <span class="string">'Bookcase'</span>);</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<p>最后，你还可以传递一个回调到contains方法来执行自己的真实测试：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line">$collection-&gt;contains(<span class="function"><span class="keyword">function</span> <span class="params">($key, $value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $value &gt; <span class="number">5</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>contains方法在检查值的时候使用「宽松」比较，这意味着一个包含整型值的字符串和同样的整型值是相等的（例如，‘1’和1相等）。要想进行严格比较，可以使用containsStrict方法。</p>
<p><strong>containsStrict()</strong></p>
<p>这个方法和contains方法签名一样，不同之处在于所有值都是「严格」比较。</p>
<p><strong>count()</strong></p>
<p>count方法返回集合中所有项的总数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line">$collection-&gt;count();</span><br><span class="line"><span class="comment">// 4</span></span><br></pre></td></tr></table></figure>
<p><strong>countBy</strong></p>
<p>方法用于计算集合中某个值出现的次数。默认情况下，该方法会计算每个元素的出现次数：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">$counted = $collection-&gt;countBy();</span><br><span class="line"></span><br><span class="line">$counted-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1 =&gt; 1, 2 =&gt; 3, 3 =&gt; 1]</span></span><br></pre></td></tr></table></figure></p>
<p>你还可以传递一个回调到该方法以便通过自定义的值计算元素出现次数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'alice@gmail.com'</span>, <span class="string">'bob@yahoo.com'</span>, <span class="string">'carlos@gmail.com'</span>]);</span><br><span class="line"></span><br><span class="line">$counted = $collection-&gt;countBy(<span class="function"><span class="keyword">function</span> <span class="params">($email)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> substr(strrchr($email, <span class="string">"@"</span>), <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$counted-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['gmail.com' =&gt; 2, 'yahoo.com' =&gt; 1]</span></span><br></pre></td></tr></table></figure>
<p><strong>crossJoin()</strong></p>
<p>crossJoin方法会在给定数组或集合之间交叉组合集合值，然后返回所有可能排列组合的笛卡尔积：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">$matrix = $collection-&gt;crossJoin([<span class="string">'a'</span>, <span class="string">'b'</span>]);</span><br><span class="line"></span><br><span class="line">$matrix-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        [1, 'a'],</span></span><br><span class="line"><span class="comment">        [1, 'b'],</span></span><br><span class="line"><span class="comment">        [2, 'a'],</span></span><br><span class="line"><span class="comment">        [2, 'b'],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">$matrix = $collection-&gt;crossJoin([<span class="string">'a'</span>, <span class="string">'b'</span>], [<span class="string">'I'</span>, <span class="string">'II'</span>]);</span><br><span class="line"></span><br><span class="line">$matrix-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        [1, 'a', 'I'],</span></span><br><span class="line"><span class="comment">        [1, 'a', 'II'],</span></span><br><span class="line"><span class="comment">        [1, 'b', 'I'],</span></span><br><span class="line"><span class="comment">        [1, 'b', 'II'],</span></span><br><span class="line"><span class="comment">        [2, 'a', 'I'],</span></span><br><span class="line"><span class="comment">        [2, 'a', 'II'],</span></span><br><span class="line"><span class="comment">        [2, 'b', 'I'],</span></span><br><span class="line"><span class="comment">        [2, 'b', 'II'],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><strong>dd()</strong></p>
<p>dd方法会打印集合项并结束脚本执行：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'John Doe'</span>, <span class="string">'Jane Doe'</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;dd();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Collection &#123;</span></span><br><span class="line"><span class="comment">        #items: array:2 [</span></span><br><span class="line"><span class="comment">            0 =&gt; "John Doe"</span></span><br><span class="line"><span class="comment">            1 =&gt; "Jane Doe"</span></span><br><span class="line"><span class="comment">        ]</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>如果你不想要终止脚本执行，可以使用dump方法来替代。</p>
<p><strong>dump()</strong></p>
<p>dump方法会打印集合项而不终止脚本执行：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'John Doe'</span>, <span class="string">'Jane Doe'</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;dump();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Collection &#123;</span></span><br><span class="line"><span class="comment">        #items: array:2 [</span></span><br><span class="line"><span class="comment">            0 =&gt; "John Doe"</span></span><br><span class="line"><span class="comment">            1 =&gt; "Jane Doe"</span></span><br><span class="line"><span class="comment">        ]</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>如果你想要在打印集合之后终止脚本执行，可以使用dd方法来替代。</p>
<p><strong>diff()</strong></p>
<p>diff方法将集合和另一个集合或原生PHP数组以基于值的方式作比较，这个方法会返回存在于原来集合而不存在于给定集合的值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line">$diff = $collection-&gt;diff([<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]);</span><br><span class="line">$diff-&gt;all();</span><br><span class="line"><span class="comment">// [1, 3, 5]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>diffAssoc()</strong></p>
<p>diffAssoc方法会基于键值将一个集合和另一个集合或原生PHP数组进行比较。该方法返回只存在于第一个集合中的键值对：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    <span class="string">'color'</span> =&gt; <span class="string">'orange'</span>,</span><br><span class="line">    <span class="string">'type'</span> =&gt; <span class="string">'fruit'</span>,</span><br><span class="line">    <span class="string">'remain'</span> =&gt; <span class="number">6</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$diff = $collection-&gt;diffAssoc([</span><br><span class="line">    <span class="string">'color'</span> =&gt; <span class="string">'yellow'</span>,</span><br><span class="line">    <span class="string">'type'</span> =&gt; <span class="string">'fruit'</span>,</span><br><span class="line">    <span class="string">'remain'</span> =&gt; <span class="number">3</span>,</span><br><span class="line">    <span class="string">'used'</span> =&gt; <span class="number">6</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$diff-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['color' =&gt; 'orange', 'remain' =&gt; 6]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>diffKeys()</strong></p>
<p>diffKeys方法会基于犍将一个集合和另一个集合或原生PHP数组进行比较。该方法会返回只存在于第一个集合的键值对：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    <span class="string">'one'</span> =&gt; <span class="number">10</span>,</span><br><span class="line">    <span class="string">'two'</span> =&gt; <span class="number">20</span>,</span><br><span class="line">    <span class="string">'three'</span> =&gt; <span class="number">30</span>,</span><br><span class="line">    <span class="string">'four'</span> =&gt; <span class="number">40</span>,</span><br><span class="line">    <span class="string">'five'</span> =&gt; <span class="number">50</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$diff = $collection-&gt;diffKeys([</span><br><span class="line">    <span class="string">'two'</span> =&gt; <span class="number">2</span>,</span><br><span class="line">    <span class="string">'four'</span> =&gt; <span class="number">4</span>,</span><br><span class="line">    <span class="string">'six'</span> =&gt; <span class="number">6</span>,</span><br><span class="line">    <span class="string">'eight'</span> =&gt; <span class="number">8</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$diff-&gt;all();</span><br><span class="line"><span class="comment">// ['one' =&gt; 10, 'three' =&gt; 30, 'five' =&gt; 50]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>duplicates()</strong></p>
<p>duplicates方法从集合中检索并返回重复值：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;duplicates();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [2 =&gt; 'a', 4 =&gt; 'b']</span></span><br></pre></td></tr></table></figure>
<p>如果集合包含数组或对象，你可以传递这些属性的键来检查是否包含重复值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$employees = collect([</span><br><span class="line">    [<span class="string">'email'</span> =&gt; <span class="string">'abigail@example.com'</span>, <span class="string">'position'</span> =&gt; <span class="string">'Developer'</span>],</span><br><span class="line">    [<span class="string">'email'</span> =&gt; <span class="string">'james@example.com'</span>, <span class="string">'position'</span> =&gt; <span class="string">'Designer'</span>],</span><br><span class="line">    [<span class="string">'email'</span> =&gt; <span class="string">'victoria@example.com'</span>, <span class="string">'position'</span> =&gt; <span class="string">'Developer'</span>],</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">$employees-&gt;duplicates(<span class="string">'position'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// [2 =&gt; 'Developer']</span></span><br></pre></td></tr></table></figure></p>
<p><strong>duplicatesStrict()</strong></p>
<p>该方法和duplicates方法使用方式类似，只不过所有值的比较使用的都是「严格」模式。</p>
<p><strong>each()</strong></p>
<p>each方法迭代集合中的数据项并传递每个数据项到给定回调：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$collection = $collection-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($item, $key)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果你想要终止对数据项的迭代，可以从回调返回false：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = $collection-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($item, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="comment">/* some condition */</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>eachSpread()</strong></p>
<p>eachSpread方法会迭代集合项，传递每个嵌套数据项值到给定集合：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([[<span class="string">'John Doe'</span>, <span class="number">35</span>], [<span class="string">'Jane Doe'</span>, <span class="number">33</span>]]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;eachSpread(<span class="function"><span class="keyword">function</span> <span class="params">($name, $age)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>你可以通过从回调中返回false来停止对集合项的迭代：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$collection-&gt;eachSpread(<span class="function"><span class="keyword">function</span> <span class="params">($name, $age)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>every()</strong></p>
<p>every方法可以用于验证集合的所有元素能够通过给定的真理测试：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])-&gt;every(<span class="function"><span class="keyword">function</span> <span class="params">($value, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $value &gt; <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>如果集合为空，every方法将返回true：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;every(<span class="function"><span class="keyword">function</span><span class="params">($value, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $value &gt; <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>
<p><strong>except()</strong></p>
<p>except方法返回集合中除了指定键的所有集合项：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'product_id'</span> =&gt; <span class="number">1</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>, <span class="string">'discount'</span> =&gt; <span class="keyword">false</span>]);</span><br><span class="line"></span><br><span class="line">$filtered = $collection-&gt;except([<span class="string">'price'</span>, <span class="string">'discount'</span>]);</span><br><span class="line"></span><br><span class="line">$filtered-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['product_id' =&gt; 1]</span></span><br></pre></td></tr></table></figure>
<p>与except相对的是only方法。</p>
<p><strong>filter()</strong></p>
<p>filter方法通过给定回调过滤集合，只有通过给定真理测试的数据项才会保留下来：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line">$filtered = $collection-&gt;filter(<span class="function"><span class="keyword">function</span> <span class="params">($value, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $value &gt; <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$filtered-&gt;all();</span><br><span class="line"><span class="comment">// [3, 4]</span></span><br></pre></td></tr></table></figure>
<p>如果没有提供回调，那么集合中所有等价于false的项都会被移除：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="string">''</span>, <span class="number">0</span>, []]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;filter()-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<p>和filter相对的方法是reject。</p>
<p><strong>first()</strong></p>
<p>first方法返回通过真理测试集合的第一个元素：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])-&gt;first(<span class="function"><span class="keyword">function</span> <span class="params">($value, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $value &gt; <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>你还可以调用不带参数的first方法来获取集合的第一个元素，如果集合是空的，返回null：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])-&gt;first();</span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure></p>
<p><strong>firstWhere()</strong></p>
<p>firstWhere方法会返回集合中的第一个元素，包含键值对：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Regena'</span>, <span class="string">'age'</span> =&gt; <span class="number">12</span>],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Linda'</span>, <span class="string">'age'</span> =&gt; <span class="number">14</span>],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Diego'</span>, <span class="string">'age'</span> =&gt; <span class="number">23</span>],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Linda'</span>, <span class="string">'age'</span> =&gt; <span class="number">84</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;firstWhere(<span class="string">'name'</span>, <span class="string">'Linda'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['name' =&gt; 'Linda', 'age' =&gt; 14]</span></span><br></pre></td></tr></table></figure></p>
<p>还可以调用带操作符的firstWhere方法：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$collection-&gt;firstWhere(<span class="string">'age'</span>, <span class="string">'&gt;='</span>, <span class="number">18</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['name' =&gt; 'Diego', 'age' =&gt; 23]</span></span><br></pre></td></tr></table></figure></p>
<p>和where方法一样，你可以传递一个参数到firstWhere方法。在这种场景中，firstWhere方法将返回给定键值对应的第一个项目：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$collection-&gt;firstWhere(<span class="string">'age'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['name' =&gt; 'Linda', 'age' =&gt; 14]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>flatMap()</strong></p>
<p>flatMap方法会迭代集合并传递每个值到给定回调，该回调可以自由编辑数据项并将其返回，最后形成一个经过编辑的新集合。然后，这个数组在层级维度被扁平化：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Sally'</span>],</span><br><span class="line">    [<span class="string">'school'</span> =&gt; <span class="string">'Arkansas'</span>],</span><br><span class="line">    [<span class="string">'age'</span> =&gt; <span class="number">28</span>]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$flattened = $collection-&gt;flatMap(<span class="function"><span class="keyword">function</span> <span class="params">($values)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> array_map(<span class="string">'strtoupper'</span>, $values);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$flattened-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['name' =&gt; 'SALLY', 'school' =&gt; 'ARKANSAS', 'age' =&gt; '28'];</span></span><br></pre></td></tr></table></figure></p>
<p><strong>flatten()</strong></p>
<p>flatten方法将多维度的集合变成一维的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'name'</span> =&gt; <span class="string">'taylor'</span>, <span class="string">'languages'</span> =&gt; [<span class="string">'php'</span>, <span class="string">'javascript'</span>]]);</span><br><span class="line"></span><br><span class="line">$flattened = $collection-&gt;flatten();</span><br><span class="line"></span><br><span class="line">$flattened-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['taylor', 'php', 'javascript'];</span></span><br></pre></td></tr></table></figure>
<p>还可以选择性传入深度参数：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    <span class="string">'Apple'</span> =&gt; [</span><br><span class="line">        [<span class="string">'name'</span> =&gt; <span class="string">'iPhone 6S'</span>, <span class="string">'brand'</span> =&gt; <span class="string">'Apple'</span>],</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'Samsung'</span> =&gt; [</span><br><span class="line">        [<span class="string">'name'</span> =&gt; <span class="string">'Galaxy S7'</span>, <span class="string">'brand'</span> =&gt; <span class="string">'Samsung'</span>]</span><br><span class="line">    ],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$products = $collection-&gt;flatten(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">$products-&gt;values()-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">    ['name' =&gt; 'iPhone 6S', 'brand' =&gt; 'Apple'],</span></span><br><span class="line"><span class="comment">    ['name' =&gt; 'Galaxy S7', 'brand' =&gt; 'Samsung'],</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>在本例中，调用不提供深度的flatten方法也会对嵌套数组进行扁平化处理，返回结果是[‘iPhone 6S’, ‘Apple’, ‘Galaxy S7’, ‘Samsung’]。提供深度允许你严格设置被扁平化的数组层级。</p>
<p><strong>flip()</strong></p>
<p>flip方法将集合的键值做交换：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'name'</span> =&gt; <span class="string">'taylor'</span>, <span class="string">'framework'</span> =&gt; <span class="string">'laravel'</span>]);</span><br><span class="line"></span><br><span class="line">$flipped = $collection-&gt;flip();</span><br><span class="line"></span><br><span class="line">$flipped-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['taylor' =&gt; 'name', 'laravel' =&gt; 'framework']</span></span><br></pre></td></tr></table></figure>
<p><strong>forget()</strong></p>
<p>forget方法通过键从集合中移除数据项：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'name'</span> =&gt; <span class="string">'taylor'</span>, <span class="string">'framework'</span> =&gt; <span class="string">'laravel'</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;forget(<span class="string">'name'</span>);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [framework' =&gt; 'laravel']</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：不同于大多数其他的集合方法，forget不返回新的修改过的集合；它只修改所调用的集合。</p>
</blockquote>
<p><strong>forPage()</strong></p>
<p>forPage方法返回新的包含给定页数数据项的集合。该方法接收页码数作为第一个参数，每页显示数据项数作为第二个参数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]);</span><br><span class="line"></span><br><span class="line">$chunk = $collection-&gt;forPage(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">$chunk-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [4, 5, 6]</span></span><br></pre></td></tr></table></figure>
<p><strong>get()</strong></p>
<p>get方法返回给定键的数据项，如果对应键不存在，返回null：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'name'</span> =&gt; <span class="string">'taylor'</span>, <span class="string">'framework'</span> =&gt; <span class="string">'laravel'</span>]);</span><br><span class="line"></span><br><span class="line">$value = $collection-&gt;get(<span class="string">'name'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// taylor</span></span><br></pre></td></tr></table></figure></p>
<p>你可以选择传递默认值作为第二个参数：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'name'</span> =&gt; <span class="string">'taylor'</span>, <span class="string">'framework'</span> =&gt; <span class="string">'laravel'</span>]);</span><br><span class="line"></span><br><span class="line">$value = $collection-&gt;get(<span class="string">'foo'</span>, <span class="string">'default-value'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// default-value</span></span><br></pre></td></tr></table></figure></p>
<p>你甚至可以传递回调作为默认值，如果给定键不存在的话回调的结果将会返回：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$collection-&gt;get(<span class="string">'email'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'default-value'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// default-value</span></span><br></pre></td></tr></table></figure></p>
<p><strong>groupBy()</strong></p>
<p>groupBy方法通过给定键分组集合数据项：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'account_id'</span> =&gt; <span class="string">'account-x10'</span>, <span class="string">'product'</span> =&gt; <span class="string">'Chair'</span>],</span><br><span class="line">    [<span class="string">'account_id'</span> =&gt; <span class="string">'account-x10'</span>, <span class="string">'product'</span> =&gt; <span class="string">'Bookcase'</span>],</span><br><span class="line">    [<span class="string">'account_id'</span> =&gt; <span class="string">'account-x11'</span>, <span class="string">'product'</span> =&gt; <span class="string">'Desk'</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$grouped = $collection-&gt;groupBy(<span class="string">'account_id'</span>);</span><br><span class="line"></span><br><span class="line">$grouped-&gt;toArray();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">    'account-x10' =&gt; [</span></span><br><span class="line"><span class="comment">        ['account_id' =&gt; 'account-x10', 'product' =&gt; 'Chair'],</span></span><br><span class="line"><span class="comment">        ['account_id' =&gt; 'account-x10', 'product' =&gt; 'Bookcase'],</span></span><br><span class="line"><span class="comment">    ],</span></span><br><span class="line"><span class="comment">    'account-x11' =&gt; [</span></span><br><span class="line"><span class="comment">        ['account_id' =&gt; 'account-x11', 'product' =&gt; 'Desk'],</span></span><br><span class="line"><span class="comment">    ],</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>除了传递字符串key，还可以传递一个回调，回调应该返回分组后的值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$grouped = $collection-&gt;groupBy(<span class="function"><span class="keyword">function</span> <span class="params">($item, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> substr($item[<span class="string">'account_id'</span>], <span class="number">-3</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$grouped-&gt;toArray();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">    'x10' =&gt; [</span></span><br><span class="line"><span class="comment">        ['account_id' =&gt; 'account-x10', 'product' =&gt; 'Chair'],</span></span><br><span class="line"><span class="comment">        ['account_id' =&gt; 'account-x10', 'product' =&gt; 'Bookcase'],</span></span><br><span class="line"><span class="comment">    ],</span></span><br><span class="line"><span class="comment">    'x11' =&gt; [</span></span><br><span class="line"><span class="comment">        ['account_id' =&gt; 'account-x11', 'product' =&gt; 'Desk'],</span></span><br><span class="line"><span class="comment">    ],</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>多个分组条件可以以一个数组的方式传递，每个数组元素都会应用到多维数组中的对应层级：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$data = <span class="keyword">new</span> Collection([</span><br><span class="line">    <span class="number">10</span> =&gt; [<span class="string">'user'</span> =&gt; <span class="number">1</span>, <span class="string">'skill'</span> =&gt; <span class="number">1</span>, <span class="string">'roles'</span> =&gt; [<span class="string">'Role_1'</span>, <span class="string">'Role_3'</span>]],</span><br><span class="line">    <span class="number">20</span> =&gt; [<span class="string">'user'</span> =&gt; <span class="number">2</span>, <span class="string">'skill'</span> =&gt; <span class="number">1</span>, <span class="string">'roles'</span> =&gt; [<span class="string">'Role_1'</span>, <span class="string">'Role_2'</span>]],</span><br><span class="line">    <span class="number">30</span> =&gt; [<span class="string">'user'</span> =&gt; <span class="number">3</span>, <span class="string">'skill'</span> =&gt; <span class="number">2</span>, <span class="string">'roles'</span> =&gt; [<span class="string">'Role_1'</span>]],</span><br><span class="line">    <span class="number">40</span> =&gt; [<span class="string">'user'</span> =&gt; <span class="number">4</span>, <span class="string">'skill'</span> =&gt; <span class="number">2</span>, <span class="string">'roles'</span> =&gt; [<span class="string">'Role_2'</span>]],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$result = $data-&gt;groupBy([</span><br><span class="line">    <span class="string">'skill'</span>,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="params">($item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $item[<span class="string">'roles'</span>];</span><br><span class="line">    &#125;,</span><br><span class="line">], $preserveKeys = <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">    1 =&gt; [</span></span><br><span class="line"><span class="comment">        'Role_1' =&gt; [</span></span><br><span class="line"><span class="comment">            10 =&gt; ['user' =&gt; 1, 'skill' =&gt; 1, 'roles' =&gt; ['Role_1', 'Role_3']],</span></span><br><span class="line"><span class="comment">            20 =&gt; ['user' =&gt; 2, 'skill' =&gt; 1, 'roles' =&gt; ['Role_1', 'Role_2']],</span></span><br><span class="line"><span class="comment">        ],</span></span><br><span class="line"><span class="comment">        'Role_2' =&gt; [</span></span><br><span class="line"><span class="comment">            20 =&gt; ['user' =&gt; 2, 'skill' =&gt; 1, 'roles' =&gt; ['Role_1', 'Role_2']],</span></span><br><span class="line"><span class="comment">        ],</span></span><br><span class="line"><span class="comment">        'Role_3' =&gt; [</span></span><br><span class="line"><span class="comment">            10 =&gt; ['user' =&gt; 1, 'skill' =&gt; 1, 'roles' =&gt; ['Role_1', 'Role_3']],</span></span><br><span class="line"><span class="comment">        ],</span></span><br><span class="line"><span class="comment">    ],</span></span><br><span class="line"><span class="comment">    2 =&gt; [</span></span><br><span class="line"><span class="comment">        'Role_1' =&gt; [</span></span><br><span class="line"><span class="comment">            30 =&gt; ['user' =&gt; 3, 'skill' =&gt; 2, 'roles' =&gt; ['Role_1']],</span></span><br><span class="line"><span class="comment">        ],</span></span><br><span class="line"><span class="comment">        'Role_2' =&gt; [</span></span><br><span class="line"><span class="comment">            40 =&gt; ['user' =&gt; 4, 'skill' =&gt; 2, 'roles' =&gt; ['Role_2']],</span></span><br><span class="line"><span class="comment">        ],</span></span><br><span class="line"><span class="comment">    ],</span></span><br><span class="line"><span class="comment">];</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><strong>has()</strong></p>
<p>has方法判断给定键是否在集合中存在：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'account_id'</span> =&gt; <span class="number">1</span>, <span class="string">'product'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'amount'</span> =&gt; <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;has(<span class="string">'product'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">$collection-&gt;has([<span class="string">'product'</span>, <span class="string">'amount'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">$collection-&gt;has([<span class="string">'amount'</span>, <span class="string">'price'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<p><strong>implode()</strong></p>
<p>implode方法连接集合中的数据项。其参数取决于集合中数据项的类型。如果集合包含数组或对象，应该传递你想要连接的属性键，以及你想要放在值之间的“粘合”字符串：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'account_id'</span> =&gt; <span class="number">1</span>, <span class="string">'product'</span> =&gt; <span class="string">'Desk'</span>],</span><br><span class="line">    [<span class="string">'account_id'</span> =&gt; <span class="number">2</span>, <span class="string">'product'</span> =&gt; <span class="string">'Chair'</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;implode(<span class="string">'product'</span>, <span class="string">', '</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Desk, Chair</span></span><br></pre></td></tr></table></figure></p>
<p>如果集合包含简单的字符串或数值，只需要传递“粘合”字符串作为唯一参数到该方法：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])-&gt;implode(<span class="string">'-'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// '1-2-3-4-5'</span></span><br></pre></td></tr></table></figure></p>
<p><strong>intersect()</strong></p>
<p>intersect方法返回两个集合的交集，结果集合将保留原来集合的键：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'Desk'</span>, <span class="string">'Sofa'</span>, <span class="string">'Chair'</span>]);</span><br><span class="line"></span><br><span class="line">$intersect = $collection-&gt;intersect([<span class="string">'Desk'</span>, <span class="string">'Chair'</span>, <span class="string">'Bookcase'</span>]);</span><br><span class="line"></span><br><span class="line">$intersect-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [0 =&gt; 'Desk', 2 =&gt; 'Chair']</span></span><br></pre></td></tr></table></figure></p>
<p><strong>intersectByKeys()</strong></p>
<p>intersectByKeys方法会从原生集合中移除任意没有在给定数组或集合中出现的键：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    <span class="string">'serial'</span> =&gt; <span class="string">'UX301'</span>, <span class="string">'type'</span> =&gt; <span class="string">'screen'</span>, <span class="string">'year'</span> =&gt; <span class="number">2009</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$intersect = $collection-&gt;intersectByKeys([</span><br><span class="line">    <span class="string">'reference'</span> =&gt; <span class="string">'UX404'</span>, <span class="string">'type'</span> =&gt; <span class="string">'tab'</span>, <span class="string">'year'</span> =&gt; <span class="number">2011</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$intersect-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['type' =&gt; 'screen', 'year' =&gt; 2009]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>isEmpty()</strong></p>
<p>如果集合为空的话isEmpty方法返回true，否则返回false：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">collect([])-&gt;isEmpty();</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p><strong>isNotEmpty()</strong></p>
<p>如果集合不为空的话isNotEmpty方法返回true，否则返回false：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">collect([])-&gt;isNotEmpty();</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<p><strong>join</strong></p>
<p>join方法用于将集合值通过字符串连接起来：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">collect([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])-&gt;join(<span class="string">', '</span>); <span class="comment">// 'a, b, c'</span></span><br><span class="line">collect([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])-&gt;join(<span class="string">', '</span>, <span class="string">', and '</span>); <span class="comment">// 'a, b, and c'</span></span><br><span class="line">collect([<span class="string">'a'</span>, <span class="string">'b'</span>])-&gt;join(<span class="string">', '</span>, <span class="string">' and '</span>); <span class="comment">// 'a and b'</span></span><br><span class="line">collect([<span class="string">'a'</span>])-&gt;join(<span class="string">', '</span>, <span class="string">' and '</span>); <span class="comment">// 'a'</span></span><br><span class="line">collect([])-&gt;join(<span class="string">', '</span>, <span class="string">' and '</span>); <span class="comment">// ''</span></span><br></pre></td></tr></table></figure></p>
<p><strong>keyBy()</strong></p>
<p>keyBy方法将指定键的值作为集合的键，如果多个数据项拥有同一个键，只有最后一个会出现在新集合里面：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'product_id'</span> =&gt; <span class="string">'prod-100'</span>, <span class="string">'name'</span> =&gt; <span class="string">'desk'</span>],</span><br><span class="line">    [<span class="string">'product_id'</span> =&gt; <span class="string">'prod-200'</span>, <span class="string">'name'</span> =&gt; <span class="string">'chair'</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$keyed = $collection-&gt;keyBy(<span class="string">'product_id'</span>);</span><br><span class="line"></span><br><span class="line">$keyed-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">    'prod-100' =&gt; ['product_id' =&gt; 'prod-100', 'name' =&gt; 'Desk'],</span></span><br><span class="line"><span class="comment">    'prod-200' =&gt; ['product_id' =&gt; 'prod-200', 'name' =&gt; 'Chair'],</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>你还可以传递自己的回调到该方法，该回调将会返回经过处理的键的值作为新的集合键：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$keyed = $collection-&gt;keyBy(<span class="function"><span class="keyword">function</span> <span class="params">($item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> strtoupper($item[<span class="string">'product_id'</span>]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$keyed-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        'PROD-100' =&gt; ['product_id' =&gt; 'prod-100', 'name' =&gt; 'Desk'],</span></span><br><span class="line"><span class="comment">        'PROD-200' =&gt; ['product_id' =&gt; 'prod-200', 'name' =&gt; 'Chair'],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><strong>keys()</strong></p>
<p>keys方法返回所有集合的键：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    <span class="string">'prod-100'</span> =&gt; [<span class="string">'product_id'</span> =&gt; <span class="string">'prod-100'</span>, <span class="string">'name'</span> =&gt; <span class="string">'Desk'</span>],</span><br><span class="line">    <span class="string">'prod-200'</span> =&gt; [<span class="string">'product_id'</span> =&gt; <span class="string">'prod-200'</span>, <span class="string">'name'</span> =&gt; <span class="string">'Chair'</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$keys = $collection-&gt;keys();</span><br><span class="line"></span><br><span class="line">$keys-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['prod-100', 'prod-200']</span></span><br></pre></td></tr></table></figure></p>
<p><strong>last()</strong></p>
<p>last方法返回通过真理测试的集合的最后一个元素：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])-&gt;last(<span class="function"><span class="keyword">function</span> <span class="params">($value, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $value &lt; <span class="number">3</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure></p>
<p>还可以调用无参的last方法来获取集合的最后一个元素。如果集合为空。返回null：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])-&gt;last();</span><br><span class="line"><span class="comment">// 4</span></span><br></pre></td></tr></table></figure>
<p><strong>macro()</strong></p>
<p>静态macro方法允许你在运行时添加方法到Collection类，更多细节可以查看扩展集合部分文档。</p>
<p><strong>make()</strong></p>
<p>静态make方法会创建一个新的集合实例，细节可查看创建集合部分文档。</p>
<p><strong>map()</strong></p>
<p>map方法遍历集合并传递每个值给给定回调。该回调可以修改数据项并返回，从而生成一个新的经过修改的集合：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$multiplied = $collection-&gt;map(<span class="function"><span class="keyword">function</span> <span class="params">($item, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $item * <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$multiplied-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [2, 4, 6, 8, 10]</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注：和大多数集合方法一样，map返回新的集合实例；它并不修改所调用的实例。如果你想要改变原来的集合，使用transform方法。</p>
</blockquote>
<p><strong>mapInto()</strong></p>
<p>mapInto()方法会迭代集合，通过传递值到构造器来为给定类创建新的实例：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Currency</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new currency instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  string  $code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(string $code)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;code = $code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$collection = collect([<span class="string">'USD'</span>, <span class="string">'EUR'</span>, <span class="string">'GBP'</span>]);</span><br><span class="line"></span><br><span class="line">$currencies = $collection-&gt;mapInto(Currency::class);</span><br><span class="line"></span><br><span class="line">$currencies-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [Currency('USD'), Currency('EUR'), Currency('GBP')]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>mapSpread()</strong></p>
<p>mapSpread方法会迭代集合项，传递每个嵌套集合项值到给定回调。在回调中我们可以修改集合项并将其返回，从而通过修改的值组合成一个新的集合：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]);</span><br><span class="line"></span><br><span class="line">$chunks = $collection-&gt;chunk(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">$sequence = $chunks-&gt;mapSpread(<span class="function"><span class="keyword">function</span> <span class="params">($odd, $even)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $odd + $even;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$sequence-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 5, 9, 13, 17]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>mapToGroups()</strong></p>
<p>mapToGroups方法会通过给定回调对集合项进行分组，回调会返回包含单个键值对的关联数组，从而将分组后的值组合成一个新的集合：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [</span><br><span class="line">        <span class="string">'name'</span> =&gt; <span class="string">'John Doe'</span>,</span><br><span class="line">        <span class="string">'department'</span> =&gt; <span class="string">'Sales'</span>,</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">'name'</span> =&gt; <span class="string">'Jane Doe'</span>,</span><br><span class="line">        <span class="string">'department'</span> =&gt; <span class="string">'Sales'</span>,</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">'name'</span> =&gt; <span class="string">'Johnny Doe'</span>,</span><br><span class="line">        <span class="string">'department'</span> =&gt; <span class="string">'Marketing'</span>,</span><br><span class="line">    ]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$grouped = $collection-&gt;mapToGroups(<span class="function"><span class="keyword">function</span> <span class="params">($item, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [$item[<span class="string">'department'</span>] =&gt; $item[<span class="string">'name'</span>]];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$grouped-&gt;toArray();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        'Sales' =&gt; ['John Doe', 'Jane Doe'],</span></span><br><span class="line"><span class="comment">        'Marketing' =&gt; ['Johhny Doe'],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">$grouped-&gt;get(<span class="string">'Sales'</span>)-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['John Doe', 'Jane Doe']</span></span><br></pre></td></tr></table></figure>
<p><strong>mapWithKeys()</strong></p>
<p>mapWithKeys方法对集合进行迭代并传递每个值到给定回调，该回调会返回包含键值对的关联数组：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [</span><br><span class="line">        <span class="string">'name'</span> =&gt; <span class="string">'John'</span>,</span><br><span class="line">        <span class="string">'department'</span> =&gt; <span class="string">'Sales'</span>,</span><br><span class="line">        <span class="string">'email'</span> =&gt; <span class="string">'john@example.com'</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">'name'</span> =&gt; <span class="string">'Jane'</span>,</span><br><span class="line">        <span class="string">'department'</span> =&gt; <span class="string">'Marketing'</span>,</span><br><span class="line">        <span class="string">'email'</span> =&gt; <span class="string">'jane@example.com'</span></span><br><span class="line">    ]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$keyed = $collection-&gt;mapWithKeys(<span class="function"><span class="keyword">function</span> <span class="params">($item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [$item[<span class="string">'email'</span>] =&gt; $item[<span class="string">'name'</span>]];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$keyed-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">    'john<span class="doctag">@example</span>.com' =&gt; 'John',</span></span><br><span class="line"><span class="comment">    'jane<span class="doctag">@example</span>.com' =&gt; 'Jane',</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><strong>max()</strong></p>
<p>max方法返回集合中给定键的最大值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$max = collect([[<span class="string">'foo'</span> =&gt; <span class="number">10</span>], [<span class="string">'foo'</span> =&gt; <span class="number">20</span>]])-&gt;max(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 20</span></span><br><span class="line"></span><br><span class="line">$max = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])-&gt;max();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5</span></span><br></pre></td></tr></table></figure></p>
<p><strong>median()</strong></p>
<p>median方法会返回给定键的中位数：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$median = collect([[<span class="string">'foo'</span> =&gt; <span class="number">10</span>], [<span class="string">'foo'</span> =&gt; <span class="number">10</span>], [<span class="string">'foo'</span> =&gt; <span class="number">20</span>], [<span class="string">'foo'</span> =&gt; <span class="number">40</span>]])-&gt;median(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 15</span></span><br><span class="line"></span><br><span class="line">$median = collect([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>])-&gt;median();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.5</span></span><br></pre></td></tr></table></figure></p>
<p><strong>merge()</strong></p>
<p>merge方法合并给定数组到集合。该数组中的任何字符串键匹配集合中的字符串键的将会重写集合中的值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'product_id'</span> =&gt; <span class="number">1</span>, <span class="string">'name'</span> =&gt; <span class="string">'Desk'</span>]);</span><br><span class="line"></span><br><span class="line">$merged = $collection-&gt;merge([<span class="string">'price'</span> =&gt; <span class="number">100</span>, <span class="string">'discount'</span> =&gt; <span class="keyword">false</span>]);</span><br><span class="line"></span><br><span class="line">$merged-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['product_id' =&gt; 1, 'name' =&gt; 'Desk', 'price' =&gt; 100, 'discount' =&gt; false]</span></span><br></pre></td></tr></table></figure></p>
<p>如果给定数组的键是数字，数组的值将会附加到集合后面：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'Desk'</span>, <span class="string">'Chair'</span>]);</span><br><span class="line"></span><br><span class="line">$merged = $collection-&gt;merge([<span class="string">'Bookcase'</span>, <span class="string">'Door'</span>]);</span><br><span class="line"></span><br><span class="line">$merged-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['Desk', 'Chair', 'Bookcase', 'Door']</span></span><br></pre></td></tr></table></figure></p>
<p><strong>mergeRecursive()</strong></p>
<p>mergeRecursive()方法会递归合并给定数组或集合到原来的集合，如果给定项中的某个字符串键和原集合中的字符串键匹配，那么这些键对应的值就会被合并到一个数组中，而且这个操作是递归的：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'product_id'</span> =&gt; <span class="number">1</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>]);</span><br><span class="line"></span><br><span class="line">$merged = $collection-&gt;mergeRecursive([<span class="string">'product_id'</span> =&gt; <span class="number">2</span>, <span class="string">'price'</span> =&gt; <span class="number">200</span>, <span class="string">'discount'</span> =&gt; <span class="keyword">false</span>]);</span><br><span class="line"></span><br><span class="line">$merged-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['product_id' =&gt; [1, 2], 'price' =&gt; [100, 200], 'discount' =&gt; false]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>min()</strong></p>
<p>min方法返回集合中给定键的最小值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$min = collect([[<span class="string">'foo'</span> =&gt; <span class="number">10</span>], [<span class="string">'foo'</span> =&gt; <span class="number">20</span>]])-&gt;min(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">$min = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])-&gt;min();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure></p>
<p><strong>mode()</strong></p>
<p>mode方法会返回给定键的众数：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$mode = collect([[<span class="string">'foo'</span> =&gt; <span class="number">10</span>], [<span class="string">'foo'</span> =&gt; <span class="number">10</span>], [<span class="string">'foo'</span> =&gt; <span class="number">20</span>], [<span class="string">'foo'</span> =&gt; <span class="number">40</span>]])-&gt;mode(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// [10]</span></span><br><span class="line"></span><br><span class="line">$mode = collect([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>])-&gt;mode();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>nth()</strong></p>
<p>nth方法组合集合中第n-th个元素创建一个新的集合：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;nth(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['a', 'e']</span></span><br></pre></td></tr></table></figure>
<p>还可以传递一个offset（偏移位置）作为第二个参数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$collection-&gt;nth(<span class="number">4</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['b', 'f']</span></span><br></pre></td></tr></table></figure>
<p><strong>only()</strong></p>
<p>only方法返回集合中指定键的集合项：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'product_id'</span> =&gt; <span class="number">1</span>, <span class="string">'name'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>, <span class="string">'discount'</span> =&gt; <span class="keyword">false</span>]);</span><br><span class="line"></span><br><span class="line">$filtered = $collection-&gt;only([<span class="string">'product_id'</span>, <span class="string">'name'</span>]);</span><br><span class="line"></span><br><span class="line">$filtered-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['product_id' =&gt; 1, 'name' =&gt; 'Desk']</span></span><br></pre></td></tr></table></figure></p>
<p>与only方法相对的是except方法。</p>
<p><strong>pad()</strong></p>
<p>pad方法将给定值填充数组直到达到指定的最大长度。该方法和PHP函数array_pad类似。</p>
<p>如果你想要把数据填充到左侧，需要指定一个负值长度，如果指定长度绝对值小于等于数组长度那么将不会做任何填充：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>]);</span><br><span class="line"></span><br><span class="line">$filtered = $collection-&gt;pad(<span class="number">5</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">$filtered-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['A', 'B', 'C', 0, 0]</span></span><br><span class="line"></span><br><span class="line">$filtered = $collection-&gt;pad(<span class="number">-5</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">$filtered-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [0, 0, 'A', 'B', 'C']</span></span><br></pre></td></tr></table></figure></p>
<p><strong>partition()</strong></p>
<p>partition方法可以和PHP函数list一起使用，从而将通过真理测试和没通过的分割开来：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">list</span>($underThree, $aboveThree) = $collection-&gt;partition(<span class="function"><span class="keyword">function</span> <span class="params">($i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $i &lt; <span class="number">3</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$underThree-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2]</span></span><br><span class="line"></span><br><span class="line">$aboveThree-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>pipe()</strong></p>
<p>pipe方法传递集合到给定回调并返回结果：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">$piped = $collection-&gt;pipe(<span class="function"><span class="keyword">function</span> <span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;sum();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6</span></span><br></pre></td></tr></table></figure></p>
<p><strong>pluck()</strong></p>
<p>pluck方法为给定键获取所有集合值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'product_id'</span> =&gt; <span class="string">'prod-100'</span>, <span class="string">'name'</span> =&gt; <span class="string">'Desk'</span>],</span><br><span class="line">    [<span class="string">'product_id'</span> =&gt; <span class="string">'prod-200'</span>, <span class="string">'name'</span> =&gt; <span class="string">'Chair'</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$plucked = $collection-&gt;pluck(<span class="string">'name'</span>);</span><br><span class="line"></span><br><span class="line">$plucked-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['Desk', 'Chair']</span></span><br></pre></td></tr></table></figure></p>
<p>还可以指定你想要结果集合如何设置键：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$plucked = $collection-&gt;pluck(<span class="string">'name'</span>, <span class="string">'product_id'</span>);</span><br><span class="line"></span><br><span class="line">$plucked-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['prod-100' =&gt; 'Desk', 'prod-200' =&gt; 'Chair']</span></span><br></pre></td></tr></table></figure></p>
<p>如果存在重复键，最后一个匹配的元素将会插入集合：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'brand'</span> =&gt; <span class="string">'Tesla'</span>,  <span class="string">'color'</span> =&gt; <span class="string">'red'</span>],</span><br><span class="line">    [<span class="string">'brand'</span> =&gt; <span class="string">'Pagani'</span>, <span class="string">'color'</span> =&gt; <span class="string">'white'</span>],</span><br><span class="line">    [<span class="string">'brand'</span> =&gt; <span class="string">'Tesla'</span>,  <span class="string">'color'</span> =&gt; <span class="string">'black'</span>],</span><br><span class="line">    [<span class="string">'brand'</span> =&gt; <span class="string">'Pagani'</span>, <span class="string">'color'</span> =&gt; <span class="string">'orange'</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$plucked = $collection-&gt;pluck(<span class="string">'color'</span>, <span class="string">'brand'</span>);</span><br><span class="line"></span><br><span class="line">$plucked-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['Tesla' =&gt; 'black', 'Pagani' =&gt; 'orange']</span></span><br></pre></td></tr></table></figure></p>
<p><strong>pop()</strong></p>
<p>pop方法移除并返回集合中最后面的数据项：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;pop();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>prepend()</strong></p>
<p>prepend方法添加数据项到集合开头：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;prepend(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [0, 1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure></p>
<p>你还可以传递第二个参数到该方法用于设置前置项的键：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'one'</span> =&gt; <span class="number">1</span>, <span class="string">'two'</span>, =&gt; <span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;prepend(<span class="number">0</span>, <span class="string">'zero'</span>);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['zero' =&gt; 0, 'one' =&gt; 1, 'two', =&gt; 2]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>pull()</strong></p>
<p>pull方法通过键从集合中移除并返回数据项：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'product_id'</span> =&gt; <span class="string">'prod-100'</span>, <span class="string">'name'</span> =&gt; <span class="string">'Desk'</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;pull(<span class="string">'name'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 'Desk'</span></span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['product_id' =&gt; 'prod-100']</span></span><br></pre></td></tr></table></figure></p>
<p><strong>push()</strong></p>
<p>push方法附加数据项到集合结尾：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;push(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>put()</strong></p>
<p>put方法在集合中设置给定键和值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'product_id'</span> =&gt; <span class="number">1</span>, <span class="string">'name'</span> =&gt; <span class="string">'Desk'</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;put(<span class="string">'price'</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['product_id' =&gt; 1, 'name' =&gt; 'Desk', 'price' =&gt; 100]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>random()</strong></p>
<p>random方法从集合中返回随机数据项：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;random();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4 - (retrieved randomly)</span></span><br></pre></td></tr></table></figure>
<p>你可以传递一个整型数据到random函数来指定返回的数据数目，如果该整型数值大于1，将会返回一个集合：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$random = $collection-&gt;random(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">$random-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [2, 4, 5] - (retrieved randomly)</span></span><br></pre></td></tr></table></figure>
<p>如果集合中的元素个数小于请求的随机数，该方法会抛出InvalidArgumentException。</p>
<p><strong>reduce()</strong></p>
<p>reduce方法用于减少集合到单个值，传递每个迭代结果到子迭代：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">$total = $collection-&gt;reduce(<span class="function"><span class="keyword">function</span> <span class="params">($carry, $item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $carry + $item;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6</span></span><br></pre></td></tr></table></figure></p>
<p>在第一次迭代时$carry的值是null；不过，你可以通过传递第二个参数到reduce来指定其初始值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection-&gt;reduce(<span class="function"><span class="keyword">function</span> <span class="params">($carry, $item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $carry + $item;</span><br><span class="line">&#125;, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10</span></span><br></pre></td></tr></table></figure></p>
<p><strong>reject()</strong></p>
<p>reject方法使用给定回调过滤集合，该回调应该为所有它想要从结果集合中移除的数据项返回true：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line">$filtered = $collection-&gt;reject(<span class="function"><span class="keyword">function</span> <span class="params">($value, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $value &gt; <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$filtered-&gt;all();</span><br><span class="line"><span class="comment">// [1, 2]</span></span><br></pre></td></tr></table></figure></p>
<p>和reject方法相对的方法是filter方法。</p>
<p><strong>replace()</strong></p>
<p>replace方法和merge方法有点像，不过，除了通过字符串键覆盖匹配项之外，replace方法还会覆盖集合中匹配的数字键：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'Taylor'</span>, <span class="string">'Abigail'</span>, <span class="string">'James'</span>]);</span><br><span class="line"></span><br><span class="line">$replaced = $collection-&gt;replace([<span class="number">1</span> =&gt; <span class="string">'Victoria'</span>, <span class="number">3</span> =&gt; <span class="string">'Finn'</span>]);</span><br><span class="line"></span><br><span class="line">$replaced-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['Taylor', 'Victoria', 'James', 'Finn']</span></span><br></pre></td></tr></table></figure></p>
<p><strong>replaceRecursive()</strong></p>
<p>该方法和replace方法类似，但是它会递归数组并应用同样的替换逻辑到内部值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'Taylor'</span>, <span class="string">'Abigail'</span>, [<span class="string">'James'</span>, <span class="string">'Victoria'</span>, <span class="string">'Finn'</span>]]);</span><br><span class="line"></span><br><span class="line">$replaced = $collection-&gt;replaceRecursive([<span class="string">'Charlie'</span>, <span class="number">2</span> =&gt; [<span class="number">1</span> =&gt; <span class="string">'King'</span>]]);</span><br><span class="line"></span><br><span class="line">$replaced-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['Charlie', 'Abigail', ['James', 'King', 'Finn']]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>reverse()</strong></p>
<p>reverse方法将集合数据项的顺序颠倒：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>]);</span><br><span class="line"></span><br><span class="line">$reversed = $collection-&gt;reverse();</span><br><span class="line"></span><br><span class="line">$reversed-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        4 =&gt; 'e',</span></span><br><span class="line"><span class="comment">        3 =&gt; 'd',</span></span><br><span class="line"><span class="comment">        2 =&gt; 'c',</span></span><br><span class="line"><span class="comment">        1 =&gt; 'b',</span></span><br><span class="line"><span class="comment">        0 =&gt; 'a',</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><strong>search()</strong></p>
<p>search方法为给定值查询集合，如果找到的话返回对应的键，如果没找到，则返回false：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;search(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure></p>
<p>上面的搜索使用的是「宽松」比较，要使用「严格」比较，传递true作为第二个参数到该方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$collection-&gt;search(<span class="string">'4'</span>, <span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>此外，你还可以传递自己的回调来搜索通过真理测试的第一个数据项：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$collection-&gt;search(<span class="function"><span class="keyword">function</span> <span class="params">($item, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $item &gt; <span class="number">5</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure></p>
<p><strong>shift()</strong></p>
<p>shift方法从集合中移除并返回第一个数据项：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;shift();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>shuffle()</strong></p>
<p>shuffle方法随机打乱集合中的数据项：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$shuffled = $collection-&gt;shuffle();</span><br><span class="line"></span><br><span class="line">$shuffled-&gt;all();</span><br><span class="line"><span class="comment">// [3, 2, 5, 1, 4] // (随机生成)</span></span><br></pre></td></tr></table></figure></p>
<p><strong>skip()</strong></p>
<p>skip方法返回一个新的跳过给定数据项的集合：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]);</span><br><span class="line"></span><br><span class="line">$collection = $collection-&gt;skip(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [5, 6, 7, 8, 9, 10]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>slice()</strong></p>
<p>slice方法从给定索引开始返回集合的一个切片：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]);</span><br><span class="line"></span><br><span class="line">$slice = $collection-&gt;slice(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">$slice-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [5, 6, 7, 8, 9, 10]</span></span><br></pre></td></tr></table></figure></p>
<p>如果你想要限制返回切片的尺寸，将尺寸值作为第二个参数传递到该方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$slice = $collection-&gt;slice(<span class="number">4</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">$slice-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [5, 6]</span></span><br></pre></td></tr></table></figure>
<p>返回的切片有新的、数字化索引的键，如果你想要保持原有的键，可以使用values方法对它们进行重新索引。</p>
<p><strong>some</strong></p>
<p>contains方法的别名。</p>
<p><strong>sort()</strong></p>
<p>sort方法对集合进行排序，排序后的集合保持原来的数组键，在本例中我们使用values方法重置键为连续编号索引：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line">$sorted = $collection-&gt;sort();</span><br><span class="line"></span><br><span class="line">$sorted-&gt;values()-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure></p>
<p>如果你需要更加高级的排序，你可以使用自己的算法传递一个回调给sort方法。参考PHP官方文档关于uasort的说明，sort方法底层正是调用了该方法。</p>
<blockquote>
<p>注：要为嵌套集合和对象排序，查看sortBy和sortByDesc方法。</p>
</blockquote>
<p><strong>sortBy()</strong></p>
<p>sortBy方法通过给定键对集合进行排序，排序后的集合保持原有数组索引，在本例中，使用values方法重置键为连续索引：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">200</span>],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Chair'</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Bookcase'</span>, <span class="string">'price'</span> =&gt; <span class="number">150</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$sorted = $collection-&gt;sortBy(<span class="string">'price'</span>);</span><br><span class="line"></span><br><span class="line">$sorted-&gt;values()-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">    ['name' =&gt; 'Chair', 'price' =&gt; 100],</span></span><br><span class="line"><span class="comment">    ['name' =&gt; 'Bookcase', 'price' =&gt; 150],</span></span><br><span class="line"><span class="comment">    ['name' =&gt; 'Desk', 'price' =&gt; 200],</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>你还可以传递自己的回调来判断如何排序集合的值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'colors'</span> =&gt; [<span class="string">'Black'</span>, <span class="string">'Mahogany'</span>]],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Chair'</span>, <span class="string">'colors'</span> =&gt; [<span class="string">'Black'</span>]],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Bookcase'</span>, <span class="string">'colors'</span> =&gt; [<span class="string">'Red'</span>, <span class="string">'Beige'</span>, <span class="string">'Brown'</span>]],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$sorted = $collection-&gt;sortBy(<span class="function"><span class="keyword">function</span> <span class="params">($product, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> count($product[<span class="string">'colors'</span>]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$sorted-&gt;values()-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        ['name' =&gt; 'Chair', 'colors' =&gt; ['Black']],</span></span><br><span class="line"><span class="comment">        ['name' =&gt; 'Desk', 'colors' =&gt; ['Black', 'Mahogany']],</span></span><br><span class="line"><span class="comment">        ['name' =&gt; 'Bookcase', 'colors' =&gt; ['Red', 'Beige', 'Brown']],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><strong>sortByDesc()</strong></p>
<p>该方法和sortBy用法相同，不同之处在于按照相反顺序进行排序。</p>
<p><strong>sortKeys</strong></p>
<p>sortKeys方法通过底层关联数组的键对集合进行排序：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    <span class="string">'id'</span> =&gt; <span class="number">22345</span>,</span><br><span class="line">    <span class="string">'first'</span> =&gt; <span class="string">'John'</span>,</span><br><span class="line">    <span class="string">'last'</span> =&gt; <span class="string">'Doe'</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$sorted = $collection-&gt;sortKeys();</span><br><span class="line"></span><br><span class="line">$sorted-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        'first' =&gt; 'John',</span></span><br><span class="line"><span class="comment">        'id' =&gt; 22345,</span></span><br><span class="line"><span class="comment">        'last' =&gt; 'Doe',</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><strong>sortKeysDesc</strong></p>
<p>该方法和sortKeys方法方法签名相同，但是排序顺序与其相反。</p>
<p><strong>splice()</strong></p>
<p>splice方法从给定位置开始移除并返回数据项切片：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$chunk = $collection-&gt;splice(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">$chunk-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [3, 4, 5]</span></span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2]</span></span><br></pre></td></tr></table></figure></p>
<p>你可以传递参数来限制返回组块的大小：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$chunk = $collection-&gt;splice(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">$chunk-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [3]</span></span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2, 4, 5]</span></span><br></pre></td></tr></table></figure></p>
<p>此外，你可以传递第三个包含新的数据项的参数来替代从集合中移除的数据项：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$chunk = $collection-&gt;splice(<span class="number">2</span>, <span class="number">1</span>, [<span class="number">10</span>, <span class="number">11</span>]);</span><br><span class="line"></span><br><span class="line">$chunk-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [3]</span></span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2, 10, 11, 4, 5]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>split()</strong></p>
<p>split方法通过给定数值对集合进行分组：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$groups = $collection-&gt;split(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">$groups-&gt;toArray();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [[1, 2], [3, 4], [5]]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>sum()</strong></p>
<p>sum方法返回集合中所有数据项的和：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])-&gt;sum();</span><br><span class="line"><span class="comment">// 15</span></span><br></pre></td></tr></table></figure></p>
<p>如果集合包含嵌套数组或对象，应该传递一个键用于判断对哪些值进行求和运算：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'JavaScript: The Good Parts'</span>, <span class="string">'pages'</span> =&gt; <span class="number">176</span>],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'JavaScript: The Definitive Guide'</span>, <span class="string">'pages'</span> =&gt; <span class="number">1096</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;sum(<span class="string">'pages'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1272</span></span><br></pre></td></tr></table></figure></p>
<p>此外，你还可以传递自己的回调来判断对哪些值进行求和：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Chair'</span>, <span class="string">'colors'</span> =&gt; [<span class="string">'Black'</span>]],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'colors'</span> =&gt; [<span class="string">'Black'</span>, <span class="string">'Mahogany'</span>]],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Bookcase'</span>, <span class="string">'colors'</span> =&gt; [<span class="string">'Red'</span>, <span class="string">'Beige'</span>, <span class="string">'Brown'</span>]],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;sum(<span class="function"><span class="keyword">function</span> <span class="params">($product)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> count($product[<span class="string">'colors'</span>]);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 6</span></span><br></pre></td></tr></table></figure></p>
<p><strong>take()</strong></p>
<p>take方法使用指定数目的数据项返回一个新的集合：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$chunk = $collection-&gt;take(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">$chunk-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [0, 1, 2]</span></span><br></pre></td></tr></table></figure></p>
<p>你还可以传递负数的方式从集合末尾开始获取指定数目的数据项：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$chunk = $collection-&gt;take(<span class="number">-2</span>);</span><br><span class="line"></span><br><span class="line">$chunk-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [4, 5]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>tap()</strong></p>
<p>tap方法会传递集合到给定回调，从而允许你在指定入口进入集合并对集合项进行处理而不影响集合本身：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">collect([<span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>])</span><br><span class="line">    -&gt;sort()</span><br><span class="line">    -&gt;tap(<span class="function"><span class="keyword">function</span> <span class="params">($collection)</span> </span>&#123;</span><br><span class="line">        Log::debug(<span class="string">'Values after sorting'</span>, $collection-&gt;values()-&gt;toArray());</span><br><span class="line">    &#125;)</span><br><span class="line">    -&gt;shift();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure></p>
<p><strong>times()</strong></p>
<p>通过静态times()方法可以通过调用指定次数的回调创建一个新的集合：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = Collection::times(<span class="number">10</span>, <span class="function"><span class="keyword">function</span> <span class="params">($number)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $number * <span class="number">9</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [9, 18, 27, 36, 45, 54, 63, 72, 81, 90]</span></span><br></pre></td></tr></table></figure></p>
<p>该方法在和工厂方法一起创建Eloquent模型时很有用：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$categories = Collection::times(<span class="number">3</span>, <span class="function"><span class="keyword">function</span> <span class="params">($number)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> factory(Category::class)-&gt;create([<span class="string">'name'</span> =&gt; <span class="string">'Category #'</span>.$number]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$categories-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        ['id' =&gt; 1, 'name' =&gt; 'Category #1'],</span></span><br><span class="line"><span class="comment">        ['id' =&gt; 2, 'name' =&gt; 'Category #2'],</span></span><br><span class="line"><span class="comment">        ['id' =&gt; 3, 'name' =&gt; 'Category #3'],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><strong>toArray()</strong></p>
<p>toArray方法将集合转化为一个原生的PHP数组。如果集合的值是Eloquent模型，该模型也会被转化为数组：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'name'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">200</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;toArray();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        ['name' =&gt; 'Desk', 'price' =&gt; 200],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注：toArray还会将所有Arrayable实例嵌套对象集合转化为数组。如果你想要获取底层数组，使用all方法。</p>
</blockquote>
<p><strong>toJson()</strong></p>
<p>toJson方法将集合转化为JSON：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'name'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">200</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;toJson();</span><br><span class="line"></span><br><span class="line"><span class="comment">// '&#123;"name":"Desk","price":200&#125;'</span></span><br></pre></td></tr></table></figure></p>
<p><strong>transform()</strong></p>
<p>transform方法迭代集合并对集合中每个数据项调用给定回调。集合中的数据项将会被替代成从回调中返回的值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;transform(<span class="function"><span class="keyword">function</span> <span class="params">($item, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $item * <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [2, 4, 6, 8, 10]</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注意：不同于大多数其它集合方法，transform修改集合本身，如果你想要创建一个新的集合，使用map方法。</p>
</blockquote>
<p><strong>union()</strong></p>
<p>union方法添加给定数组到集合，如果给定数组包含已经在原来集合中存在的犍，原生集合的值会被保留：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span> =&gt; [<span class="string">'a'</span>], <span class="number">2</span> =&gt; [<span class="string">'b'</span>]]);</span><br><span class="line"></span><br><span class="line">$union = $collection-&gt;union([<span class="number">3</span> =&gt; [<span class="string">'c'</span>], <span class="number">1</span> =&gt; [<span class="string">'b'</span>]]);</span><br><span class="line"></span><br><span class="line">$union-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1 =&gt; ['a'], 2 =&gt; ['b'], [3 =&gt; ['c']]</span></span><br></pre></td></tr></table></figure></p>
<p><strong>unique()</strong></p>
<p>unique方法返回集合中所有的唯一数据项，返回的集合保持原来的数组键，在本例中我们使用values方法重置这些键为连续的数字索引 ：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">$unique = $collection-&gt;unique();</span><br><span class="line"></span><br><span class="line">$unique-&gt;values()-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure></p>
<p>处理嵌套数组或对象时，可以指定用于判断唯一的键：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'iPhone 6'</span>, <span class="string">'brand'</span> =&gt; <span class="string">'Apple'</span>, <span class="string">'type'</span> =&gt; <span class="string">'phone'</span>],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'iPhone 5'</span>, <span class="string">'brand'</span> =&gt; <span class="string">'Apple'</span>, <span class="string">'type'</span> =&gt; <span class="string">'phone'</span>],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Apple Watch'</span>, <span class="string">'brand'</span> =&gt; <span class="string">'Apple'</span>, <span class="string">'type'</span> =&gt; <span class="string">'watch'</span>],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Galaxy S6'</span>, <span class="string">'brand'</span> =&gt; <span class="string">'Samsung'</span>, <span class="string">'type'</span> =&gt; <span class="string">'phone'</span>],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Galaxy Gear'</span>, <span class="string">'brand'</span> =&gt; <span class="string">'Samsung'</span>, <span class="string">'type'</span> =&gt; <span class="string">'watch'</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$unique = $collection-&gt;unique(<span class="string">'brand'</span>);</span><br><span class="line"></span><br><span class="line">$unique-&gt;values()-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        ['name' =&gt; 'iPhone 6', 'brand' =&gt; 'Apple', 'type' =&gt; 'phone'],</span></span><br><span class="line"><span class="comment">        ['name' =&gt; 'Galaxy S6', 'brand' =&gt; 'Samsung', 'type' =&gt; 'phone'],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>你还可以指定自己的回调用于判断数据项唯一性：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$unique = $collection-&gt;unique(<span class="function"><span class="keyword">function</span> <span class="params">($item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $item[<span class="string">'brand'</span>].$item[<span class="string">'type'</span>];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$unique-&gt;values()-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        ['name' =&gt; 'iPhone 6', 'brand' =&gt; 'Apple', 'type' =&gt; 'phone'],</span></span><br><span class="line"><span class="comment">        ['name' =&gt; 'Apple Watch', 'brand' =&gt; 'Apple', 'type' =&gt; 'watch'],</span></span><br><span class="line"><span class="comment">        ['name' =&gt; 'Galaxy S6', 'brand' =&gt; 'Samsung', 'type' =&gt; 'phone'],</span></span><br><span class="line"><span class="comment">        ['name' =&gt; 'Galaxy Gear', 'brand' =&gt; 'Samsung', 'type' =&gt; 'watch'],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>unique方法在检查数据项值的时候使用「宽松」比较，也就是说一个整型字符串和整型数值被看作是相等的，如果要「严格」比较可以使用uniqueStrict方法。</p>
<p><strong>uniqueStrict()</strong></p>
<p>该方法和unique方法签名一样，不同之处在于所有值都是「严格」比较。</p>
<p><strong>unless()</strong></p>
<p>unless方法会执行给定回调，除非传递到该方法的第一个参数等于true：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;unless(<span class="keyword">true</span>, <span class="function"><span class="keyword">function</span> <span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;push(<span class="number">4</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection-&gt;unless(<span class="keyword">false</span>, <span class="function"><span class="keyword">function</span> <span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;push(<span class="number">5</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2, 3, 5]</span></span><br></pre></td></tr></table></figure></p>
<p>与unless相对的方法是when。</p>
<p><strong>unlessEmpty()</strong></p>
<p>whenNotEmpty方法的别名。</p>
<p><strong>unlessNotEmpty()</strong></p>
<p>whenEmpty方法的别名。</p>
<p><strong>unwrap()</strong></p>
<p>静态unwrap方法会从给定值中返回集合项：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Collection::unwrap(collect(<span class="string">'John Doe'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['John Doe']</span></span><br><span class="line"></span><br><span class="line">Collection::unwrap([<span class="string">'John Doe'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['John Doe']</span></span><br><span class="line"></span><br><span class="line">Collection::unwrap(<span class="string">'John Doe'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 'John Doe'</span></span><br></pre></td></tr></table></figure>
<p><strong>values()</strong></p>
<p>values方法通过将集合键重置为连续整型数字的方式返回新的集合：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    <span class="number">10</span> =&gt; [<span class="string">'product'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">200</span>],</span><br><span class="line">    <span class="number">11</span> =&gt; [<span class="string">'product'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">200</span>]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$values = $collection-&gt;values();</span><br><span class="line"></span><br><span class="line">$values-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        0 =&gt; ['product' =&gt; 'Desk', 'price' =&gt; 200],</span></span><br><span class="line"><span class="comment">        1 =&gt; ['product' =&gt; 'Desk', 'price' =&gt; 200],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><strong>when()</strong></p>
<p>when方法在传入的第一个参数执行结果为true时执行给定回调：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;when(<span class="keyword">true</span>, <span class="function"><span class="keyword">function</span> <span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;push(<span class="number">4</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection-&gt;when(<span class="keyword">false</span>, <span class="function"><span class="keyword">function</span> <span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;push(<span class="number">5</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure></p>
<p>与when方法相对的是unless。</p>
<p><strong>whenEmpty()</strong></p>
<p>当集合为空时，whenEmpty方法会执行给定回调：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'michael'</span>, <span class="string">'tom'</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;whenEmpty(<span class="function"><span class="keyword">function</span> <span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;push(<span class="string">'adam'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['michael', 'tom']</span></span><br><span class="line"></span><br><span class="line">$collection = collect();</span><br><span class="line"></span><br><span class="line">$collection-&gt;whenEmpty(<span class="function"><span class="keyword">function</span> <span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;push(<span class="string">'adam'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['adam']</span></span><br><span class="line"></span><br><span class="line">$collection = collect([<span class="string">'michael'</span>, <span class="string">'tom'</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;whenEmpty(<span class="function"><span class="keyword">function</span><span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;push(<span class="string">'adam'</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span><span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;push(<span class="string">'taylor'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['michael', 'tom', 'taylor']</span></span><br></pre></td></tr></table></figure></p>
<p>与whenEmpty相对的方法是whenNotEmpty。</p>
<p><strong>whenNotEmpty()</strong></p>
<p>当集合不为空时，whenNotEmpty方法会执行给定回调：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'michael'</span>, <span class="string">'tom'</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;whenNotEmpty(<span class="function"><span class="keyword">function</span> <span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;push(<span class="string">'adam'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['michael', 'tom', 'adam']</span></span><br><span class="line"></span><br><span class="line">$collection = collect();</span><br><span class="line"></span><br><span class="line">$collection-&gt;whenNotEmpty(<span class="function"><span class="keyword">function</span> <span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;push(<span class="string">'adam'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// []</span></span><br><span class="line"></span><br><span class="line">$collection = collect();</span><br><span class="line"></span><br><span class="line">$collection-&gt;whenNotEmpty(<span class="function"><span class="keyword">function</span><span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;push(<span class="string">'adam'</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span><span class="params">($collection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $collection-&gt;push(<span class="string">'taylor'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['taylor']</span></span><br></pre></td></tr></table></figure></p>
<p>与whenNotEmpty相对的方法是whenEmpty。</p>
<p><strong>where()</strong></p>
<p>where方法通过给定键值对过滤集合：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">200</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Chair'</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Bookcase'</span>, <span class="string">'price'</span> =&gt; <span class="number">150</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Door'</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$filtered = $collection-&gt;where(<span class="string">'price'</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">$filtered-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">    ['product' =&gt; 'Chair', 'price' =&gt; 100],</span></span><br><span class="line"><span class="comment">    ['product' =&gt; 'Door', 'price' =&gt; 100],</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>检查数据项值时where方法使用「宽松」比较，也就是说整型字符串和整型数组是等价的。使用whereStrict方法使用「严格」比较进行过滤。</p>
<p>作为可选项，你可以传递比较操作符作为where方法的第二个参数：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Jim'</span>, <span class="string">'deleted_at'</span> =&gt; <span class="string">'2019-01-01 00:00:00'</span>],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Sally'</span>, <span class="string">'deleted_at'</span> =&gt; <span class="string">'2019-01-02 00:00:00'</span>],</span><br><span class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'Sue'</span>, <span class="string">'deleted_at'</span> =&gt; <span class="keyword">null</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$filtered = $collection-&gt;where(<span class="string">'deleted_at'</span>, <span class="string">'!='</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">$filtered-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        ['name' =&gt; 'Jim', 'deleted_at' =&gt; '2019-01-01 00:00:00'],</span></span><br><span class="line"><span class="comment">        ['name' =&gt; 'Sally', 'deleted_at' =&gt; '2019-01-02 00:00:00'],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><strong>whereStrict()</strong></p>
<p>该方法和where用法签名一样，不同之处在于，所有值都使用「严格」比较。</p>
<p><strong>whereBetween()</strong></p>
<p>whereBetween方法通过给定范围过滤集合：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">200</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Chair'</span>, <span class="string">'price'</span> =&gt; <span class="number">80</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Bookcase'</span>, <span class="string">'price'</span> =&gt; <span class="number">150</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Pencil'</span>, <span class="string">'price'</span> =&gt; <span class="number">30</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Door'</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$filtered = $collection-&gt;whereBetween(<span class="string">'price'</span>, [<span class="number">100</span>, <span class="number">200</span>]);</span><br><span class="line"></span><br><span class="line">$filtered-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        ['product' =&gt; 'Desk', 'price' =&gt; 200],</span></span><br><span class="line"><span class="comment">        ['product' =&gt; 'Bookcase', 'price' =&gt; 150],</span></span><br><span class="line"><span class="comment">        ['product' =&gt; 'Door', 'price' =&gt; 100],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><strong>whereIn()</strong></p>
<p>whereIn方法通过包含在给定数组中的键值对集合进行过滤：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">200</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Chair'</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Bookcase'</span>, <span class="string">'price'</span> =&gt; <span class="number">150</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Door'</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$filtered = $collection-&gt;whereIn(<span class="string">'price'</span>, [<span class="number">150</span>, <span class="number">200</span>]);</span><br><span class="line"></span><br><span class="line">$filtered-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">    ['product' =&gt; 'Bookcase', 'price' =&gt; 150],</span></span><br><span class="line"><span class="comment">    ['product' =&gt; 'Desk', 'price' =&gt; 200],</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>whereIn方法在检查数据项值的时候使用「宽松」比较，要使用「严格」比较可以使用whereInStrict方法。</p>
<p><strong>whereInStrict()</strong></p>
<p>该方法和whereIn方法签名相同，不同之处在于whereInStrict在比较值的时候使用「严格」比较。</p>
<p><strong>whereInstanceOf</strong></p>
<p>whereInstanceOf方法通过给定类的类型过滤集合：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    <span class="keyword">new</span> User,</span><br><span class="line">    <span class="keyword">new</span> User,</span><br><span class="line">    <span class="keyword">new</span> Post,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $collection-&gt;whereInstanceOf(User::class);</span><br></pre></td></tr></table></figure></p>
<p><strong>whereNotBetween()</strong></p>
<p>whereNotBetween方法通过给定范围过滤集合：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">200</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Chair'</span>, <span class="string">'price'</span> =&gt; <span class="number">80</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Bookcase'</span>, <span class="string">'price'</span> =&gt; <span class="number">150</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Pencil'</span>, <span class="string">'price'</span> =&gt; <span class="number">30</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Door'</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$filtered = $collection-&gt;whereNotBetween(<span class="string">'price'</span>, [<span class="number">100</span>, <span class="number">200</span>]);</span><br><span class="line"></span><br><span class="line">$filtered-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        ['product' =&gt; 'Chair', 'price' =&gt; 80],</span></span><br><span class="line"><span class="comment">        ['product' =&gt; 'Pencil', 'price' =&gt; 30],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><strong>whereNotIn()</strong></p>
<p>whereNotIn方法通过给定键值过滤不在给定数组中的集合数据项：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Desk'</span>, <span class="string">'price'</span> =&gt; <span class="number">200</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Chair'</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Bookcase'</span>, <span class="string">'price'</span> =&gt; <span class="number">150</span>],</span><br><span class="line">    [<span class="string">'product'</span> =&gt; <span class="string">'Door'</span>, <span class="string">'price'</span> =&gt; <span class="number">100</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$filtered = $collection-&gt;whereNotIn(<span class="string">'price'</span>, [<span class="number">150</span>, <span class="number">200</span>]);</span><br><span class="line"></span><br><span class="line">$filtered-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">        ['product' =&gt; 'Chair', 'price' =&gt; 100],</span></span><br><span class="line"><span class="comment">        ['product' =&gt; 'Door', 'price' =&gt; 100],</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>whereNotIn方法在检查集合项值的时候使用「宽松」比较，也就是说整型字符串和整型数值被看作是相等的。要想进行严格过滤可以使用whereNotInStrict方法。</p>
<p><strong>whereNotInStrict()</strong></p>
<p>该方法和whereNotIn方法签名一样，不同之处在于所有值都使用「严格」比较。</p>
<p><strong>wrap()</strong></p>
<p>静态wrap方法会将给定值封装到集合中：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$collection = Collection::wrap(<span class="string">'John Doe'</span>);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['John Doe']</span></span><br><span class="line"></span><br><span class="line">$collection = Collection::wrap([<span class="string">'John Doe'</span>]);</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['John Doe']</span></span><br><span class="line"></span><br><span class="line">$collection = Collection::wrap(collect(<span class="string">'John Doe'</span>));</span><br><span class="line"></span><br><span class="line">$collection-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['John Doe']</span></span><br></pre></td></tr></table></figure></p>
<p><strong>zip()</strong></p>
<p>zip方法在与集合的值对应的索引处合并给定数组的值：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$collection = collect([<span class="string">'Chair'</span>, <span class="string">'Desk'</span>]);</span><br><span class="line"></span><br><span class="line">$zipped = $collection-&gt;zip([<span class="number">100</span>, <span class="number">200</span>]);</span><br><span class="line"></span><br><span class="line">$zipped-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [['Chair', 100], ['Desk', 200]]</span></span><br></pre></td></tr></table></figure></p>
<h1 id="高阶消息传递"><a href="#高阶消息传递" class="headerlink" title="高阶消息传递"></a>高阶消息传递</h1><p>集合还支持“高阶消息传递”，也就是在集合上执行通用的功能，支持高阶消息传递的方法包括：average、avg、contains、each、every、filter、first、flatMap、groupBy、keyBy、map、max、min、partition、reject、some、sortBy、sortByDesc、sum和unique。</p>
<p>每个高阶消息传递都可以在集合实例上以动态属性的方式访问，例如，我们使用each高阶消息传递来在集合的每个对象上调用一个方法：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$users = User::where(<span class="string">'votes'</span>, <span class="string">'&gt;'</span>, <span class="number">500</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line">$users-&gt;each-&gt;markAsVip();</span><br></pre></td></tr></table></figure></p>
<p>类似的，我们可以使用sum高阶消息传递来聚合用户集合的投票总数：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$users = User::where(<span class="string">'group'</span>, <span class="string">'Development'</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $users-&gt;sum-&gt;votes;</span><br></pre></td></tr></table></figure></p>
<h1 id="懒集合"><a href="#懒集合" class="headerlink" title="懒集合"></a><span style="color:#339AFF;">懒集合</span></h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a><span style="color:#00ACC1;">简介</span></h2><p>为了继续完善功能已经很强大的Collection类，LazyCollection类使用了PHP的生成器，从而可以通过极低的内存处理极大的数据集。</p>
<p>例如，假设你的应用需要通过Laravel提供的集合方法来解析并处理几个GB大小的日志文件，这个时候就可以使用懒集合（LazyCollection），它不会一次性将整个文件读入内存，而是每次只读取文件的一小部分：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">LogEntry</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">LazyCollection</span>;</span><br><span class="line"></span><br><span class="line">LazyCollection::make(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    $handle = fopen(<span class="string">'log.txt'</span>, <span class="string">'r'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (($line = fgets($handle)) !== <span class="keyword">false</span>) &#123;</span><br><span class="line">        <span class="keyword">yield</span> $line;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)-&gt;chunk(<span class="number">4</span>)-&gt;map(<span class="function"><span class="keyword">function</span> <span class="params">($lines)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> LogEntry::fromLines($lines);</span><br><span class="line">&#125;)-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">(LogEntry $logEntry)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Process the log entry...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>或者，假设你需要迭代10000个Eloquent模型实例，使用传统的Laravel集合，所有10000个 Eloquent模型实例必须一次性加载到内存中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$users = App\User::all()-&gt;filter(<span class="function"><span class="keyword">function</span> <span class="params">($user)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $user-&gt;id &gt; <span class="number">500</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>而现在，查询构建器的cursor方法会返回一个LazyCollection实例，这样一来，我们仍然只需对数据库做一次查询，但是一次只会加载一个Eloquent模型实例到内存。在这个例子中，filter回调只有在迭代到每个独立用户时才会执行，从而大幅降低对内存的占用：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$users = App\User::cursor()-&gt;filter(<span class="function"><span class="keyword">function</span> <span class="params">($user)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $user-&gt;id &gt; <span class="number">500</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($users <span class="keyword">as</span> $user) &#123;</span><br><span class="line">    <span class="keyword">echo</span> $user-&gt;id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="创建懒集合"><a href="#创建懒集合" class="headerlink" title="创建懒集合"></a><span style="color:#00ACC1;">创建懒集合</span></h2><p>要创建一个懒集合实例，需要传递一个PHP生成器函数到集合的make方法：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">LazyCollection</span>;</span><br><span class="line"></span><br><span class="line">LazyCollection::make(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    $handle = fopen(<span class="string">'log.txt'</span>, <span class="string">'r'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (($line = fgets($handle)) !== <span class="keyword">false</span>) &#123;</span><br><span class="line">        <span class="keyword">yield</span> $line;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="Enumerable契约"><a href="#Enumerable契约" class="headerlink" title="Enumerable契约"></a><span style="color:#00ACC1;">Enumerable契约</span></h2><p>几乎所有的Collection类方法都对LazyCollection类有效，因为这两个类都实现了Illuminate\Support\Enumerable契约，该契约中声明了如下方法：</p>
<ul>
<li>all</li>
<li>average</li>
<li>avg</li>
<li>chunk</li>
<li>collapse</li>
<li>collect</li>
<li>combine</li>
<li>concat</li>
<li>contains</li>
<li>containsStrict</li>
<li>count</li>
<li>countBy</li>
<li>crossJoin</li>
<li>dd</li>
<li>diff</li>
<li>diffAssoc</li>
<li>diffKeys</li>
<li>dump</li>
<li>duplicates</li>
<li>duplicatesStrict</li>
<li>each</li>
<li>eachSpread</li>
<li>every</li>
<li>except</li>
<li>filter</li>
<li>first</li>
<li>firstWhere</li>
<li>flatMap</li>
<li>flatten</li>
<li>flip</li>
<li>forPage</li>
<li>get</li>
<li>groupBy</li>
<li>has</li>
<li>implode</li>
<li>intersect</li>
<li>intersectByKeys</li>
<li>isEmpty</li>
<li>isNotEmpty</li>
<li>join</li>
<li>keyBy</li>
<li>keys</li>
<li>last</li>
<li>macro</li>
<li>make</li>
<li>map</li>
<li>mapInto</li>
<li>mapSpread</li>
<li>mapToGroups</li>
<li>mapWithKeys</li>
<li>max</li>
<li>median</li>
<li>merge</li>
<li>mergeRecursive</li>
<li>min</li>
<li>mode</li>
<li>nth</li>
<li>only</li>
<li>pad</li>
<li>partition</li>
<li>pipe</li>
<li>pluck</li>
<li>random</li>
<li>reduce</li>
<li>reject</li>
<li>replace</li>
<li>replaceRecursive</li>
<li>reverse</li>
<li>search</li>
<li>shuffle</li>
<li>skip</li>
<li>slice</li>
<li>some</li>
<li>sort</li>
<li>sortBy</li>
<li>sortByDesc</li>
<li>sortKeys</li>
<li>sortKeysDesc</li>
<li>split</li>
<li>sum</li>
<li>take</li>
<li>tap</li>
<li>times</li>
<li>toArray</li>
<li>toJson</li>
<li>union</li>
<li>unique</li>
<li>uniqueStrict</li>
<li>unless</li>
<li>unlessEmpty</li>
<li>unlessNotEmpty</li>
<li>unwrap</li>
<li>values</li>
<li>when</li>
<li>whenEmpty</li>
<li>whenNotEmpty</li>
<li>where</li>
<li>whereStrict</li>
<li>whereBetween</li>
<li>whereIn</li>
<li>whereInStrict</li>
<li>whereInstanceOf</li>
<li>whereNotBetween</li>
<li>whereNotIn</li>
<li>whereNotInStrict</li>
<li>wrap</li>
<li>zip</li>
</ul>
<blockquote>
<p>注：改变集合的方法（例如shift、pop、prepend等）在LazyCollection类中不可用。</p>
</blockquote>
<h2 id="懒集合方法"><a href="#懒集合方法" class="headerlink" title="懒集合方法"></a><span style="color:#00ACC1;">懒集合方法</span></h2><p>除了定义在Enumerable契约中的方法，LazyCollection类还包含以下方法：</p>
<p><strong>tapEach()</strong></p>
<p>each方法会为每个集合项立即调用给定回调，tapEach方法则只有在这些集合项从列表中一个一个拉取出来时才会调用给定回调：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$lazyCollection = LazyCollection::times(INF)-&gt;tapEach(<span class="function"><span class="keyword">function</span> <span class="params">($value)</span> </span>&#123;</span><br><span class="line">    dump($value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Nothing has been dumped so far...</span></span><br><span class="line"></span><br><span class="line">$array = $lazyCollection-&gt;take(<span class="number">3</span>)-&gt;all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<h1 id="LazyCollection"><a href="#LazyCollection" class="headerlink" title="LazyCollection"></a><span style="color:#339AFF;">LazyCollection</span></h1><blockquote>
<p>Illuminate\Support\LazyCollection.php</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Support</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">ArrayIterator</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Traits</span>\<span class="title">EnumeratesValues</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Traits</span>\<span class="title">Macroable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">IteratorAggregate</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">stdClass</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LazyCollection</span> <span class="keyword">implements</span> <span class="title">Enumerable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">EnumeratesValues</span>, <span class="title">Macroable</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The source from which to generate items.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> callable|static</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new lazy collection instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  mixed  $source</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($source = null)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($source <span class="keyword">instanceof</span> Closure || $source <span class="keyword">instanceof</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = $source;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (is_null($source)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="keyword">static</span>::empty();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="keyword">$this</span>-&gt;getArrayableItems($source);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new instance with no items.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> static</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">empty</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">static</span>([]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new instance by invoking the callback a given amount of times.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $number</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  callable|null  $callback</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> static</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">times</span><span class="params">($number, callable $callback = null)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($number &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">static</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $instance = <span class="keyword">new</span> <span class="keyword">static</span>(<span class="function"><span class="keyword">function</span> <span class="params">()</span> <span class="title">use</span> <span class="params">($number)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> ($current = <span class="number">1</span>; $current &lt;= $number; $current++) &#123;</span><br><span class="line">                <span class="keyword">yield</span> $current;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> is_null($callback) ? $instance : $instance-&gt;map($callback);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create an enumerable with the given range.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $from</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> static</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">range</span><span class="params">($from, $to)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">static</span>(<span class="function"><span class="keyword">function</span> <span class="params">()</span> <span class="title">use</span> <span class="params">($from, $to)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (; $from &lt;= $to; $from++) &#123;</span><br><span class="line">                <span class="keyword">yield</span> $from;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get all items in the enumerable.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">all</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (is_array(<span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;source;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> iterator_to_array(<span class="keyword">$this</span>-&gt;getIterator());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Eager load all items into a new lazy collection backed by an array.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> static</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eager</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">static</span>(<span class="keyword">$this</span>-&gt;all());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Laravel/" rel="tag"># Laravel</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/04/12/第9章-诱导玩家贴近概念/" rel="next" title="第9章 诱导玩家贴近概念">
                <i class="fa fa-chevron-left"></i> 第9章 诱导玩家贴近概念
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/04/12/Laravel-Cache/" rel="prev" title="Laravel-Cache">
                Laravel-Cache <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Chebin">
            
              <p class="site-author-name" itemprop="name">Chebin</p>
              <div class="site-description motion-element" itemprop="description">记录自己的学习过程</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">407</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">65</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          


          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <!-- modify icon to fire by szw -->
                <i class="fa fa-history fa-" aria-hidden="true"></i>
                近期文章
              </div>
              <ul class="links-of-blogroll-list">
                
                
                  <li>
                    <a href="/2020/04/19/第9关-关卡设计/" title="第9关 关卡设计" target="_blank">第9关 关卡设计</a>
                  </li>
                
                  <li>
                    <a href="/2020/04/18/第3章-体验发生于场景/" title="第3章-体验发生于场景" target="_blank">第3章-体验发生于场景</a>
                  </li>
                
                  <li>
                    <a href="/2020/04/18/第7章-确定操作感/" title="第7章-确定操作感" target="_blank">第7章-确定操作感</a>
                  </li>
                
                  <li>
                    <a href="/2020/04/17/Laravel-Throttle/" title="Laravel-Throttle" target="_blank">Laravel-Throttle</a>
                  </li>
                
                  <li>
                    <a href="/2020/04/16/Unity-责任链模式/" title="Unity-责任链模式" target="_blank">Unity-责任链模式</a>
                  </li>
                
              </ul>
            </div>
        

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建集合"><span class="nav-number">1.1.</span> <span class="nav-text">创建集合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#扩展集合"><span class="nav-number">1.2.</span> <span class="nav-text">扩展集合</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#集合方法"><span class="nav-number">2.</span> <span class="nav-text">集合方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#方法列表"><span class="nav-number">3.</span> <span class="nav-text">方法列表</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#高阶消息传递"><span class="nav-number">4.</span> <span class="nav-text">高阶消息传递</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#懒集合"><span class="nav-number">5.</span> <span class="nav-text">懒集合</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介-1"><span class="nav-number">5.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建懒集合"><span class="nav-number">5.2.</span> <span class="nav-text">创建懒集合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Enumerable契约"><span class="nav-number">5.3.</span> <span class="nav-text">Enumerable契约</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#懒集合方法"><span class="nav-number">5.4.</span> <span class="nav-text">懒集合方法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LazyCollection"><span class="nav-number">6.</span> <span class="nav-text">LazyCollection</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chebin</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">4.3m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">65:10</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
